var glue=function(e,n){"use strict";var t,o,r,i,c,s,a,u,l=function(){var t,o={};return o.open=function(){try{var r;r=e.match("^https://")?"wss"+e.substr(5):"ws"+e.substr(4),r+=n.baseURL+"ws",t=new WebSocket(r),t.onmessage=function(e){o.onMessage(e.data.toString())},t.onerror=function(e){var n="the websocket closed the connection with ";n+=e.code?"the error code: "+e.code:"an error.",o.onError(n)},t.onclose=function(){o.onClose()},t.onopen=function(){o.onOpen()}}catch(i){o.onError()}},o.send=function(e){t.send(e)},o.reset=function(){t&&t.close(),t=void 0},o},f=function(){var t,o,r,i=e+n.baseURL+"ajax",c=8e3,s=45e3,a={Timeout:"t",Closed:"c"},u={Delimiter:"&",Init:"i",Push:"u",Poll:"o"},l={},f=!1,d=!1,g=function(){r=function(){},f&&f.abort(),d&&d.abort()},v=function(){g(),l.onClose()},m=function(e){g(),e=e?"the ajax socket closed the connection with the error: "+e:"the ajax socket closed the connection with an error.",l.onError(e)},h=function(e,n){d=$.ajax({url:i,success:function(e){d=!1,n&&n(e)},error:function(e,n){d=!1,m(n)},type:"POST",data:e,dataType:"text",timeout:c})};return r=function(){f=$.ajax({url:i,success:function(e){if(f=!1,e==a.Timeout)return void r();if(e==a.Closed)return void v();var n=e.indexOf(u.Delimiter);return 0>n?void m("ajax socket: failed to split poll token from data!"):(o=e.substring(0,n),e=e.substr(n+1),r(),void l.onMessage(e))},error:function(e,n){f=!1,m(n)},type:"POST",data:u.Poll+t+u.Delimiter+o,dataType:"text",timeout:s})},l.open=function(){h(u.Init,function(e){var n=e.indexOf(u.Delimiter);return 0>n?void m("ajax socket: failed to split uid and poll token from data!"):(t=e.substring(0,n),o=e.substr(n+1),r(),void l.onOpen())})},l.send=function(e){h(u.Push+t+u.Delimiter+e)},l.reset=function(){g()},l},d="1.3.1",g="m",v={WebSocket:"WebSocket",AjaxSocket:"AjaxSocket"},m={Len:2,Init:"in",Ping:"pi",Pong:"po",Close:"cl",Invalid:"iv",DontAutoReconnect:"dr",ChannelData:"cd"},h={Disconnected:"disconnected",Connecting:"connecting",Reconnecting:"reconnecting",Connected:"connected"},p={baseURL:"/glue/",forceSocketType:!1,connectTimeout:1e4,pingInterval:35e3,pingReconnectTimeout:5e3,reconnect:!0,reconnectDelay:1e3,reconnectDelayMax:5e3,reconnectAttempts:10,resetSendBufferTimeout:1e4},b=!1,y=!1,k=h.Disconnected,S=0,M=!1,T=!1,O=!1,x=!1,w=[],D=!1,C=!1,j=!1,L=[],I=function(){var e="&",n={};return n.unmarshalValues=function(n){if(!n)return!1;var t=n.indexOf(e),o=parseInt(n.substring(0,t),10);if(n=n.substring(t+1),0>o||o>n.length)return!1;var r=n.substr(0,o),i=n.substr(o);return{first:r,second:i}},n.marshalValues=function(n,t){return String(n.length)+e+n+t},n}(),R=function(){var e={},n={},t=function(e){var n={onMessageFunc:function(){}};return n.instance={onMessage:function(e){n.onMessageFunc=e},send:function(n,t){return n?s(m.ChannelData,I.marshalValues(e,n),t):-1}},n};return e.get=function(e){if(!e)return!1;var o=n[e];return o?o.instance:(o=t(e),n[e]=o,o.instance)},e.emitOnMessage=function(e,t){if(e&&t){var o=n[e];if(!o)return void console.log("glue: channel '"+e+"': emit onMessage event: channel does not exists");try{o.onMessageFunc(t)}catch(r){return void console.log("glue: channel '"+e+"': onMessage event call failed: "+r.message)}}},e}();c=function(e){return b?j?void b.send(e):void L.push(e):void 0};var P=function(){if(0!==L.length){for(var e=0;e<L.length;e++)c(L[e]);L=[]}},A=function(){C=!1,D!==!1&&(clearTimeout(D),D=!1)},B=function(){D!==!1||C||(D=setTimeout(function(){if(D=!1,C=!0,0!==w.length){for(var e,n=0;n<w.length;n++)if(e=w[n],e.discardCallback&&$.isFunction(e.discardCallback))try{e.discardCallback(e.data)}catch(t){console.log("glue: failed to call discard callback: "+t.message)}u("discard_send_buffer"),w=[]}},n.resetSendBufferTimeout))},U=function(){if(A(),0!==w.length){for(var e,n=0;n<w.length;n++)e=w[n],c(e.cmd+e.data);w=[]}};s=function(e,n,t){return n||(n=""),b&&k===h.Connected?(c(e+n),1):C?(t&&$.isFunction(t)&&t(n),-1):(B(),w.push({cmd:e,data:n,discardCallback:t}),0)};var E=function(){T!==!1&&(clearTimeout(T),T=!1)},J=function(){E(),T=setTimeout(function(){T=!1,u("connect_timeout"),a()},n.connectTimeout)},N=function(){O!==!1&&(clearTimeout(O),O=!1),x!==!1&&(clearTimeout(x),x=!1)},W=function(){N(),O=setTimeout(function(){O=!1,c(m.Ping),x=setTimeout(function(){x=!1,u("timeout"),a()},n.pingReconnectTimeout)},n.pingInterval)},_=function(){return y?void(b=o()):S>1?(o=f,b=o(),void(r=v.AjaxSocket)):(!n.forceSocketType&&window.WebSocket||n.forceSocketType===v.WebSocket?(o=l,r=v.WebSocket):(o=f,r=v.AjaxSocket),void(b=o()))},F=function(e){e=JSON.parse(e),j=!0,P(),k=h.Connected,u("connected"),setTimeout(U,0)},V=function(){_(),b.onOpen=function(){E(),S=0,y=!0,W();var e={version:d};e=JSON.stringify(e),b.send(m.Init+e)},b.onClose=function(){a()},b.onError=function(e){u("error",[e]),a()},b.onMessage=function(e){if(W(),e.length<m.Len)return void console.log("glue: received invalid data from server: data is too short.");var n=e.substr(0,m.Len);if(e=e.substr(m.Len),n===m.Ping)c(m.Pong);else if(n===m.Pong);else if(n===m.Invalid)console.log("glue: server replied with an invalid request notification!");else if(n===m.DontAutoReconnect)M=!0,console.log("glue: server replied with an don't automatically reconnect request. This might be due to an incompatible protocol version.");else if(n===m.Init)F(e);else if(n===m.ChannelData){var t=I.unmarshalValues(e);if(!t)return void console.log("glue: server requested an invalid channel data request: "+e);R.emitOnMessage(t.first,t.second)}else console.log("glue: received invalid data from server with command '"+n+"' and data '"+e+"'!")},setTimeout(function(){S>0?(k=h.Reconnecting,u("reconnecting")):(k=h.Connecting,u("connecting")),J(),b.open()},0)},q=function(){E(),N(),j=!1,L=[],b&&(b.onOpen=b.onClose=b.onMessage=b.onError=function(){},b.reset(),b=!1)};if(a=function(){if(q(),n.reconnectAttempts>0&&S>n.reconnectAttempts||n.reconnect===!1||M)return k=h.Disconnected,void u("disconnected");S+=1;var e=n.reconnectDelay*S;e>n.reconnectDelayMax&&(e=n.reconnectDelayMax),setTimeout(function(){V()},e)},i=function(){b&&(c(m.Close),q(),k=h.Disconnected,u("disconnected"))},t=R.get(g),e||(e=window.location.protocol+"//"+window.location.host),!e.match("^http://")&&!e.match("^https://"))return void console.log("glue: invalid host: missing 'http://' or 'https://'!");n=$.extend(p,n),n.reconnectDelayMax<n.reconnectDelay&&(n.reconnectDelayMax=n.reconnectDelay),0!==n.baseURL.indexOf("/")&&(n.baseURL="/"+n.baseURL),"/"!==n.baseURL.slice(-1)&&(n.baseURL=n.baseURL+"/"),V();var z={version:function(){return d},type:function(){return r},state:function(){return k},send:function(e,n){t.send(e,n)},onMessage:function(e){t.onMessage(e)},on:function(){var e=$(z);e.on.apply(e,arguments)},reconnect:function(){k===h.Disconnected&&(S=0,M=!1,a())},close:function(){i()},channel:function(e){return R.get(e)}};return u=function(){var e=$(z);e.triggerHandler.apply(e,arguments)},z};Object.keys||(Object.keys=function(){"use strict";var e=Object.prototype.hasOwnProperty,n=!{toString:null}.propertyIsEnumerable("toString"),t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=t.length;return function(r){if("object"!=typeof r&&("function"!=typeof r||null===r))throw new TypeError("Object.keys called on non-object");var i,c,s=[];for(i in r)e.call(r,i)&&s.push(i);if(n)for(c=0;o>c;c++)e.call(r,t[c])&&s.push(t[c]);return s}}());var BitMonster=function(e){"use strict";var n={},t=function(){var e="&",n={};return n.randomString=function(e){for(var n="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;e>o;o++)n+=t.charAt(Math.floor(Math.random()*t.length));return n},n.unmarshalValues=function(n){if(!n)return!1;var t=n.indexOf(e),o=parseInt(n.substring(0,t),10);if(n=n.substring(t+1),0>o||o>n.length)return!1;var r=n.substr(0,o),i=n.substr(o);return{first:r,second:i}},n.marshalValues=function(n,t){return String(n.length)+e+n+t},n}(),o={en:{ConnLostWidget:{Title:"Connection Lost"}}},r=o.en,i=(navigator.language||navigator.browserLanguage).split("-")[0];i&&o[i]&&(r=o[i]);!function(){var e,n={},t='<div id="bm-conn-lost-widget"><i class="fa fa-bolt fa-2x"></i><span><p></p><small></small></span></div>',o=function(n){e.find("p").text(n)},i=function(n){e.find("small").text(n)},c=function(){e=$("#bm-conn-lost-widget"),e.length||(e=$(t),$("body").prepend(e))};return n.show=function(){c(),o(r.ConnLostWidget.Title),i(r.ConnLostWidget.Title),e.addClass("show")},n}();n.scope=function(){var e={};return function(n){if(!n)return console.log("BitMonster: invalid scope call: scope='"+n+"'"),!1;var t=e[n];t||(t={events:[]});for(var o=1;o<arguments.length;o++){var r=arguments[o];$.isFunction(r.off)?t.events.push(r):console.log("BitMonster: invalid scope call: passed invalid argument: skipping argument...")}return e[n]=t,{off:function(){for(var o=0;o<t.events.length;o++)t.events[o].off();delete e[n]}}}}();var c=function(){var n=glue(e,{baseURL:"/bitmonster/"});return n?(n.on("connected",function(){console.log("connected")}),n.on("connecting",function(){console.log("connecting")}),n.on("disconnected",function(){console.log("disconnected")}),n.on("reconnecting",function(){console.log("reconnecting")}),n.on("error",function(e,n){console.log("error: "+n)}),n.on("connect_timeout",function(){console.log("connect_timeout")}),n.on("timeout",function(){console.log("timeout")}),n.on("discard_send_buffer",function(e,n){console.log("discard_send_buffer: ");for(var t=0;t<n.length;t++)console.log("  i: "+n[t])}),n.onMessage(function(e){console.log("onMessage: "+e)}),n):void console.log("BitMonster: failed to initialize socket!")}();return n.module=function(){var e=14,n=10,o=7e3,r=c.channel("call"),i=c.channel("event"),s={},a={};r.onMessage(function(e){var n=function(){console.log("BitMonster: received invalid call request from server.")};if(e=JSON.parse(e),!e.callbackID||0===String(e.callbackID).length)return void n();var t=s[e.callbackID];if(!t)return void n();delete s[e.callbackID],t.timeout&&(clearTimeout(t.timeout),t.timeout=!1);try{if("cleanup"===e.type)return;"success"===e.type&&t.success?e.data?t.success(e.data):t.success():"error"===e.type&&t.error?e.message?t.error(e.message):t.error():n()}catch(o){console.log("BitMonster: catched exception while calling callback:"),console.log(o)}}),i.onMessage(function(e){var n=function(){console.log("BitMonster: received invalid event request from server.")};if(e=JSON.parse(e),!e.module||!e.event)return void n();var t=a[e.module];if(t){var o=t.events[e.event];if(o)if("trigger"===e.type){var r;e.data&&(r=JSON.parse(e.data));var i=jQuery.extend({},o.listeners);$.each(i,function(e,n){try{n.callback(r)}catch(t){console.log("BitMonster: catched exception while triggering event:"),console.log(t)}})}else n()}});var u=function(n,i){var c=!1,a=!1,u=!1,l=function(){console.log("BitMonster: invalid method call: module='"+n+"' method='"+i+"'")};if(!i)return l(),!1;for(var f=2;f<arguments.length;f++){var d=arguments[f];if(null!==d&&"object"==typeof d){if(c!==!1)return l(),!1;c=d}else{if(!$.isFunction(d))return l(),!1;if(a===!1)a=d;else{if(u!==!1)return l(),!1;u=d}}}c=c?JSON.stringify(c):"";var g={module:n,method:i};if(a!==!1||u!==!1){for(var v;;)if(v=t.randomString(e),!s[v])break;var m={success:a,error:u};m.timeout=setTimeout(function(){m.timeout=!1,delete s[v],m.error&&m.error("method call timeout: no server response received within the timeout")},o),s[v]=m,g.callbackID=v,g.callbackSuccess=a!==!1,g.callbackError=u!==!1}return g=JSON.stringify(g),r.send(t.marshalValues(g,c)),!0},l=function(e,n,t){var o=a[e];if(o){var r=o.events[n];if(r&&(delete r.listeners[t],!(Object.keys(r.listeners).length>0))){delete o.events[n];var c={type:"off",module:e,event:n};c=JSON.stringify(c),i.send(c)}}},f=function(e,n){var t={type:"on",module:e,event:n};t=JSON.stringify(t),i.send(t)},d=function(e,o,r){var i=a[e];i||(i={events:{}},a[e]=i);var c=i.events[o];c||(c={listeners:{}},i.events[o]=c);for(var s;;)if(s=t.randomString(n),!c.listeners[s])break;return c.listeners[s]={callback:r},1==Object.keys(c.listeners).length&&f(e,o,s),{off:function(){l(e,o,s)}}};return c.on("connected",function(){$.each(a,function(e,n){$.each(n.events,function(n,t){f(e,n)})})}),function(e){return e?{call:function(){return Array.prototype.unshift.call(arguments,e),u.apply(u,arguments)},on:function(){return Array.prototype.unshift.call(arguments,e),d.apply(d,arguments)}}:(console.log("BitMonster: invalid module call: module='"+e+"'"),!1)}}(),n};