"use strict";function q(e){throw e}function w(e,t,n){4!==t.length&&q(new sjcl.exception.invalid("invalid aes block size"));var o=e.b[n],i=t[0]^o[0],r=t[n?3:1]^o[1],c=t[2]^o[2];t=t[n?1:3]^o[3];var s,a,l,u,d=o.length/4-2,h=4,f=[0,0,0,0];s=e.k[n],e=s[0];var g=s[1],p=s[2],m=s[3],v=s[4];for(u=0;d>u;u++)s=e[i>>>24]^g[r>>16&255]^p[c>>8&255]^m[255&t]^o[h],a=e[r>>>24]^g[c>>16&255]^p[t>>8&255]^m[255&i]^o[h+1],l=e[c>>>24]^g[t>>16&255]^p[i>>8&255]^m[255&r]^o[h+2],t=e[t>>>24]^g[i>>16&255]^p[r>>8&255]^m[255&c]^o[h+3],h+=4,i=s,r=a,c=l;for(u=0;4>u;u++)f[n?3&-u:u]=v[i>>>24]<<24^v[r>>16&255]<<16^v[c>>8&255]<<8^v[255&t]^o[h++],s=i,i=r,r=c,c=t,t=s;return f}function x(e,t){var n,o,i,r=t.slice(0),c=e.r,s=e.b,a=c[0],l=c[1],u=c[2],d=c[3],h=c[4],f=c[5],g=c[6],p=c[7];for(n=0;64>n;n++)16>n?o=r[n]:(o=r[n+1&15],i=r[n+14&15],o=r[15&n]=(o>>>7^o>>>18^o>>>3^o<<25^o<<14)+(i>>>17^i>>>19^i>>>10^i<<15^i<<13)+r[15&n]+r[n+9&15]|0),o=o+p+(h>>>6^h>>>11^h>>>25^h<<26^h<<21^h<<7)+(g^h&(f^g))+s[n],p=g,g=f,f=h,h=d+o|0,d=u,u=l,l=a,a=o+(l&u^d&(l^u))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;c[0]=c[0]+a|0,c[1]=c[1]+l|0,c[2]=c[2]+u|0,c[3]=c[3]+d|0,c[4]=c[4]+h|0,c[5]=c[5]+f|0,c[6]=c[6]+g|0,c[7]=c[7]+p|0}function C(e,t){var n,o=sjcl.random.w[e],i=[];for(n in o)o.hasOwnProperty(n)&&i.push(o[n]);for(n=0;n<i.length;n++)i[n](t)}function E(e){"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?sjcl.random.addEntropy(window.performance.now(),e,"loadtime"):sjcl.random.addEntropy((new Date).valueOf(),e,"loadtime")}function A(e){e.b=B(e).concat(B(e)),e.A=new sjcl.cipher.aes(e.b)}function B(e){for(var t=0;4>t&&(e.f[t]=e.f[t]+1|0,!e.f[t]);t++);return e.A.encrypt(e.f)}function D(e,t){return function(){t.apply(e,arguments)}}var s=void 0,u=!1,sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};"undefined"!=typeof module&&module.exports&&(module.exports=sjcl),"function"==typeof define&&define([],function(){return sjcl}),sjcl.cipher.aes=function(e){this.k[0][0][0]||this.D();var t,n,o,i,r=this.k[0][4],c=this.k[1];t=e.length;var s=1;for(4!==t&&6!==t&&8!==t&&q(new sjcl.exception.invalid("invalid aes key size")),this.b=[o=e.slice(0),i=[]],e=t;4*t+28>e;e++)n=o[e-1],(0===e%t||8===t&&4===e%t)&&(n=r[n>>>24]<<24^r[n>>16&255]<<16^r[n>>8&255]<<8^r[255&n],0===e%t&&(n=n<<8^n>>>24^s<<24,s=s<<1^283*(s>>7))),o[e]=o[e-t]^n;for(t=0;e;t++,e--)n=o[3&t?e:e-4],i[t]=4>=e||4>t?n:c[0][r[n>>>24]]^c[1][r[n>>16&255]]^c[2][r[n>>8&255]]^c[3][r[255&n]]},sjcl.cipher.aes.prototype={encrypt:function(e){return w(this,e,0)},decrypt:function(e){return w(this,e,1)},k:[[[],[],[],[],[]],[[],[],[],[],[]]],D:function(){var e,t,n,o,i,r,c,s=this.k[0],a=this.k[1],l=s[4],u=a[4],d=[],h=[];for(e=0;256>e;e++)h[(d[e]=e<<1^283*(e>>7))^e]=e;for(t=n=0;!l[t];t^=o||1,n=h[n]||1)for(r=n^n<<1^n<<2^n<<3^n<<4,r=r>>8^255&r^99,l[t]=r,u[r]=t,i=d[e=d[o=d[t]]],c=16843009*i^65537*e^257*o^16843008*t,i=257*d[r]^16843008*r,e=0;4>e;e++)s[e][t]=i=i<<24^i>>>8,a[e][r]=c=c<<24^c>>>8;for(e=0;5>e;e++)s[e]=s[e].slice(0),a[e]=a[e].slice(0)}},sjcl.bitArray={bitSlice:function(e,t,n){return e=sjcl.bitArray.P(e.slice(t/32),32-(31&t)).slice(1),n===s?e:sjcl.bitArray.clamp(e,n-t)},extract:function(e,t,n){var o=Math.floor(-t-n&31);return(-32&(t+n-1^t)?e[t/32|0]<<32-o^e[t/32+1|0]>>>o:e[t/32|0]>>>o)&(1<<n)-1},concat:function(e,t){if(0===e.length||0===t.length)return e.concat(t);var n=e[e.length-1],o=sjcl.bitArray.getPartial(n);return 32===o?e.concat(t):sjcl.bitArray.P(t,o,0|n,e.slice(0,e.length-1))},bitLength:function(e){var t=e.length;return 0===t?0:32*(t-1)+sjcl.bitArray.getPartial(e[t-1])},clamp:function(e,t){if(32*e.length<t)return e;e=e.slice(0,Math.ceil(t/32));var n=e.length;return t&=31,n>0&&t&&(e[n-1]=sjcl.bitArray.partial(t,e[n-1]&2147483648>>t-1,1)),e},partial:function(e,t,n){return 32===e?t:(n?0|t:t<<32-e)+1099511627776*e},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(sjcl.bitArray.bitLength(e)!==sjcl.bitArray.bitLength(t))return u;var n,o=0;for(n=0;n<e.length;n++)o|=e[n]^t[n];return 0===o},P:function(e,t,n,o){var i;for(i=0,o===s&&(o=[]);t>=32;t-=32)o.push(n),n=0;if(0===t)return o.concat(e);for(i=0;i<e.length;i++)o.push(n|e[i]>>>t),n=e[i]<<32-t;return i=e.length?e[e.length-1]:0,e=sjcl.bitArray.getPartial(i),o.push(sjcl.bitArray.partial(t+e&31,t+e>32?n:o.pop(),1)),o},l:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]},byteswapM:function(e){var t,n;for(t=0;t<e.length;++t)n=e[t],e[t]=n>>>24|n>>>8&65280|(65280&n)<<8|n<<24;return e}},sjcl.codec.utf8String={fromBits:function(e){var t,n,o="",i=sjcl.bitArray.bitLength(e);for(t=0;i/8>t;t++)0===(3&t)&&(n=e[t/4]),o+=String.fromCharCode(n>>>24),n<<=8;return decodeURIComponent(escape(o))},toBits:function(e){e=unescape(encodeURIComponent(e));var t,n=[],o=0;for(t=0;t<e.length;t++)o=o<<8|e.charCodeAt(t),3===(3&t)&&(n.push(o),o=0);return 3&t&&n.push(sjcl.bitArray.partial(8*(3&t),o)),n}},sjcl.codec.hex={fromBits:function(e){var t,n="";for(t=0;t<e.length;t++)n+=((0|e[t])+0xf00000000000).toString(16).substr(4);return n.substr(0,sjcl.bitArray.bitLength(e)/4)},toBits:function(e){var t,n,o=[];for(e=e.replace(/\s|0x/g,""),n=e.length,e+="00000000",t=0;t<e.length;t+=8)o.push(0^parseInt(e.substr(t,8),16));return sjcl.bitArray.clamp(o,4*n)}},sjcl.codec.base64={J:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(e,t,n){var o="",i=0,r=sjcl.codec.base64.J,c=0,s=sjcl.bitArray.bitLength(e);for(n&&(r=r.substr(0,62)+"-_"),n=0;6*o.length<s;)o+=r.charAt((c^e[n]>>>i)>>>26),6>i?(c=e[n]<<6-i,i+=26,n++):(c<<=6,i-=6);for(;3&o.length&&!t;)o+="=";return o},toBits:function(e,t){e=e.replace(/\s|=/g,"");var n,o,i=[],r=0,c=sjcl.codec.base64.J,s=0;for(t&&(c=c.substr(0,62)+"-_"),n=0;n<e.length;n++)o=c.indexOf(e.charAt(n)),0>o&&q(new sjcl.exception.invalid("this isn't base64!")),r>26?(r-=26,i.push(s^o>>>r),s=o<<32-r):(r+=6,s^=o<<32-r);return 56&r&&i.push(sjcl.bitArray.partial(56&r,s,1)),i}},sjcl.codec.base64url={fromBits:function(e){return sjcl.codec.base64.fromBits(e,1,1)},toBits:function(e){return sjcl.codec.base64.toBits(e,1)}},sjcl.hash.sha256=function(e){this.b[0]||this.D(),e?(this.r=e.r.slice(0),this.o=e.o.slice(0),this.h=e.h):this.reset()},sjcl.hash.sha256.hash=function(e){return(new sjcl.hash.sha256).update(e).finalize()},sjcl.hash.sha256.prototype={blockSize:512,reset:function(){return this.r=this.N.slice(0),this.o=[],this.h=0,this},update:function(e){"string"==typeof e&&(e=sjcl.codec.utf8String.toBits(e));var t,n=this.o=sjcl.bitArray.concat(this.o,e);for(t=this.h,e=this.h=t+sjcl.bitArray.bitLength(e),t=512+t&-512;e>=t;t+=512)x(this,n.splice(0,16));return this},finalize:function(){var e,t=this.o,n=this.r,t=sjcl.bitArray.concat(t,[sjcl.bitArray.partial(1,1)]);for(e=t.length+2;15&e;e++)t.push(0);for(t.push(Math.floor(this.h/4294967296)),t.push(0|this.h);t.length;)x(this,t.splice(0,16));return this.reset(),n},N:[],b:[],D:function(){function e(e){return 4294967296*(e-Math.floor(e))|0}var t,n=0,o=2;e:for(;64>n;o++){for(t=2;o>=t*t;t++)if(0===o%t)continue e;8>n&&(this.N[n]=e(Math.pow(o,.5))),this.b[n]=e(Math.pow(o,1/3)),n++}}},sjcl.mode.ccm={name:"ccm",encrypt:function(e,t,n,o,i){var r,c=t.slice(0),s=sjcl.bitArray,a=s.bitLength(n)/8,l=s.bitLength(c)/8;for(i=i||64,o=o||[],7>a&&q(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes")),r=2;4>r&&l>>>8*r;r++);return 15-a>r&&(r=15-a),n=s.clamp(n,8*(15-r)),t=sjcl.mode.ccm.L(e,t,n,o,i,r),c=sjcl.mode.ccm.p(e,c,n,t,i,r),s.concat(c.data,c.tag)},decrypt:function(e,t,n,o,i){i=i||64,o=o||[];var r=sjcl.bitArray,c=r.bitLength(n)/8,s=r.bitLength(t),a=r.clamp(t,s-i),l=r.bitSlice(t,s-i),s=(s-i)/8;for(7>c&&q(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes")),t=2;4>t&&s>>>8*t;t++);return 15-c>t&&(t=15-c),n=r.clamp(n,8*(15-t)),a=sjcl.mode.ccm.p(e,a,n,l,i,t),e=sjcl.mode.ccm.L(e,a.data,n,o,i,t),r.equal(a.tag,e)||q(new sjcl.exception.corrupt("ccm: tag doesn't match")),a.data},L:function(e,t,n,o,i,r){var c=[],s=sjcl.bitArray,a=s.l;if(i/=8,(i%2||4>i||i>16)&&q(new sjcl.exception.invalid("ccm: invalid tag length")),(4294967295<o.length||4294967295<t.length)&&q(new sjcl.exception.bug("ccm: can't deal with 4GiB or more data")),r=[s.partial(8,(o.length?64:0)|i-2<<2|r-1)],r=s.concat(r,n),r[3]|=s.bitLength(t)/8,r=e.encrypt(r),o.length)for(n=s.bitLength(o)/8,65279>=n?c=[s.partial(16,n)]:4294967295>=n&&(c=s.concat([s.partial(16,65534)],[n])),c=s.concat(c,o),o=0;o<c.length;o+=4)r=e.encrypt(a(r,c.slice(o,o+4).concat([0,0,0])));for(o=0;o<t.length;o+=4)r=e.encrypt(a(r,t.slice(o,o+4).concat([0,0,0])));return s.clamp(r,8*i)},p:function(e,t,n,o,i,r){var c,s=sjcl.bitArray;c=s.l;var a=t.length,l=s.bitLength(t);if(n=s.concat([s.partial(8,r-1)],n).concat([0,0,0]).slice(0,4),o=s.bitSlice(c(o,e.encrypt(n)),0,i),!a)return{tag:o,data:[]};for(c=0;a>c;c+=4)n[3]++,i=e.encrypt(n),t[c]^=i[0],t[c+1]^=i[1],t[c+2]^=i[2],t[c+3]^=i[3];return{tag:o,data:s.clamp(t,l)}}},sjcl.mode.ocb2={name:"ocb2",encrypt:function(e,t,n,o,i,r){128!==sjcl.bitArray.bitLength(n)&&q(new sjcl.exception.invalid("ocb iv must be 128 bits"));var c,s=sjcl.mode.ocb2.H,a=sjcl.bitArray,l=a.l,u=[0,0,0,0];n=s(e.encrypt(n));var d,h=[];for(o=o||[],i=i||64,c=0;c+4<t.length;c+=4)d=t.slice(c,c+4),u=l(u,d),h=h.concat(l(n,e.encrypt(l(n,d)))),n=s(n);return d=t.slice(c),t=a.bitLength(d),c=e.encrypt(l(n,[0,0,0,t])),d=a.clamp(l(d.concat([0,0,0]),c),t),u=l(u,l(d.concat([0,0,0]),c)),u=e.encrypt(l(u,l(n,s(n)))),o.length&&(u=l(u,r?o:sjcl.mode.ocb2.pmac(e,o))),h.concat(a.concat(d,a.clamp(u,i)))},decrypt:function(e,t,n,o,i,r){128!==sjcl.bitArray.bitLength(n)&&q(new sjcl.exception.invalid("ocb iv must be 128 bits")),i=i||64;var c,s,a=sjcl.mode.ocb2.H,l=sjcl.bitArray,u=l.l,d=[0,0,0,0],h=a(e.encrypt(n)),f=sjcl.bitArray.bitLength(t)-i,g=[];for(o=o||[],n=0;f/32>n+4;n+=4)c=u(h,e.decrypt(u(h,t.slice(n,n+4)))),d=u(d,c),g=g.concat(c),h=a(h);return s=f-32*n,c=e.encrypt(u(h,[0,0,0,s])),c=u(c,l.clamp(t.slice(n),s).concat([0,0,0])),d=u(d,c),d=e.encrypt(u(d,u(h,a(h)))),o.length&&(d=u(d,r?o:sjcl.mode.ocb2.pmac(e,o))),l.equal(l.clamp(d,i),l.bitSlice(t,f))||q(new sjcl.exception.corrupt("ocb: tag doesn't match")),g.concat(l.clamp(c,s))},pmac:function(e,t){var n,o=sjcl.mode.ocb2.H,i=sjcl.bitArray,r=i.l,c=[0,0,0,0],s=e.encrypt([0,0,0,0]),s=r(s,o(o(s)));for(n=0;n+4<t.length;n+=4)s=o(s),c=r(c,e.encrypt(r(s,t.slice(n,n+4))));return n=t.slice(n),128>i.bitLength(n)&&(s=r(s,o(s)),n=i.concat(n,[-2147483648,0,0,0])),c=r(c,n),e.encrypt(r(o(r(s,o(s))),c))},H:function(e){return[e[0]<<1^e[1]>>>31,e[1]<<1^e[2]>>>31,e[2]<<1^e[3]>>>31,e[3]<<1^135*(e[0]>>>31)]}},sjcl.mode.gcm={name:"gcm",encrypt:function(e,t,n,o,i){var r=t.slice(0);return t=sjcl.bitArray,o=o||[],e=sjcl.mode.gcm.p(!0,e,r,o,n,i||128),t.concat(e.data,e.tag)},decrypt:function(e,t,n,o,i){var r=t.slice(0),c=sjcl.bitArray,s=c.bitLength(r);return i=i||128,o=o||[],s>=i?(t=c.bitSlice(r,s-i),r=c.bitSlice(r,0,s-i)):(t=r,r=[]),e=sjcl.mode.gcm.p(u,e,r,o,n,i),c.equal(e.tag,t)||q(new sjcl.exception.corrupt("gcm: tag doesn't match")),e.data},Z:function(e,t){var n,o,i,r,c,s=sjcl.bitArray.l;for(i=[0,0,0,0],r=t.slice(0),n=0;128>n;n++){for((o=0!==(e[Math.floor(n/32)]&1<<31-n%32))&&(i=s(i,r)),c=0!==(1&r[3]),o=3;o>0;o--)r[o]=r[o]>>>1|(1&r[o-1])<<31;r[0]>>>=1,c&&(r[0]^=-520093696)}return i},g:function(e,t,n){var o,i=n.length;for(t=t.slice(0),o=0;i>o;o+=4)t[0]^=4294967295&n[o],t[1]^=4294967295&n[o+1],t[2]^=4294967295&n[o+2],t[3]^=4294967295&n[o+3],t=sjcl.mode.gcm.Z(t,e);return t},p:function(e,t,n,o,i,r){var c,s,a,l,u,d,h,f,g=sjcl.bitArray;for(d=n.length,h=g.bitLength(n),f=g.bitLength(o),s=g.bitLength(i),c=t.encrypt([0,0,0,0]),96===s?(i=i.slice(0),i=g.concat(i,[1])):(i=sjcl.mode.gcm.g(c,[0,0,0,0],i),i=sjcl.mode.gcm.g(c,i,[0,0,Math.floor(s/4294967296),4294967295&s])),s=sjcl.mode.gcm.g(c,[0,0,0,0],o),u=i.slice(0),o=s.slice(0),e||(o=sjcl.mode.gcm.g(c,s,n)),l=0;d>l;l+=4)u[3]++,a=t.encrypt(u),n[l]^=a[0],n[l+1]^=a[1],n[l+2]^=a[2],n[l+3]^=a[3];return n=g.clamp(n,h),e&&(o=sjcl.mode.gcm.g(c,s,n)),e=[Math.floor(f/4294967296),4294967295&f,Math.floor(h/4294967296),4294967295&h],o=sjcl.mode.gcm.g(c,o,e),a=t.encrypt(i),o[0]^=a[0],o[1]^=a[1],o[2]^=a[2],o[3]^=a[3],{tag:g.bitSlice(o,0,r),data:n}}},sjcl.misc.hmac=function(e,t){this.M=t=t||sjcl.hash.sha256;var n,o=[[],[]],i=t.prototype.blockSize/32;for(this.n=[new t,new t],e.length>i&&(e=t.hash(e)),n=0;i>n;n++)o[0][n]=909522486^e[n],o[1][n]=1549556828^e[n];this.n[0].update(o[0]),this.n[1].update(o[1]),this.G=new t(this.n[0])},sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(e){return this.Q&&q(new sjcl.exception.invalid("encrypt on already updated hmac called!")),this.update(e),this.digest(e)},sjcl.misc.hmac.prototype.reset=function(){this.G=new this.M(this.n[0]),this.Q=u},sjcl.misc.hmac.prototype.update=function(e){this.Q=!0,this.G.update(e)},sjcl.misc.hmac.prototype.digest=function(){var e=this.G.finalize(),e=new this.M(this.n[1]).update(e).finalize();return this.reset(),e},sjcl.misc.pbkdf2=function(e,t,n,o,i){n=n||1e3,(0>o||0>n)&&q(sjcl.exception.invalid("invalid params to pbkdf2")),"string"==typeof e&&(e=sjcl.codec.utf8String.toBits(e)),"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t)),i=i||sjcl.misc.hmac,e=new i(e);var r,c,s,a,l=[],u=sjcl.bitArray;for(a=1;32*l.length<(o||1);a++){for(i=r=e.encrypt(u.concat(t,[a])),c=1;n>c;c++)for(r=e.encrypt(r),s=0;s<r.length;s++)i[s]^=r[s];l=l.concat(i)}return o&&(l=u.clamp(l,o)),l},sjcl.prng=function(e){this.c=[new sjcl.hash.sha256],this.i=[0],this.F=0,this.s={},this.C=0,this.K={},this.O=this.d=this.j=this.W=0,this.b=[0,0,0,0,0,0,0,0],this.f=[0,0,0,0],this.A=s,this.B=e,this.q=u,this.w={progress:{},seeded:{}},this.m=this.V=0,this.t=1,this.u=2,this.S=65536,this.I=[0,48,64,96,128,192,256,384,512,768,1024],this.T=3e4,this.R=80},sjcl.prng.prototype={randomWords:function(e,t){var n,o=[];n=this.isReady(t);var i;if(n===this.m&&q(new sjcl.exception.notReady("generator isn't seeded")),n&this.u){n=!(n&this.t),i=[];var r,c=0;for(this.O=i[0]=(new Date).valueOf()+this.T,r=0;16>r;r++)i.push(4294967296*Math.random()|0);for(r=0;r<this.c.length&&(i=i.concat(this.c[r].finalize()),c+=this.i[r],this.i[r]=0,!(!n&&this.F&1<<r));r++);for(this.F>=1<<this.c.length&&(this.c.push(new sjcl.hash.sha256),this.i.push(0)),this.d-=c,c>this.j&&(this.j=c),this.F++,this.b=sjcl.hash.sha256.hash(this.b.concat(i)),this.A=new sjcl.cipher.aes(this.b),n=0;4>n&&(this.f[n]=this.f[n]+1|0,!this.f[n]);n++);}for(n=0;e>n;n+=4)0===(n+1)%this.S&&A(this),i=B(this),o.push(i[0],i[1],i[2],i[3]);return A(this),o.slice(0,e)},setDefaultParanoia:function(e,t){0===e&&"Setting paranoia=0 will ruin your security; use it only for testing"!==t&&q("Setting paranoia=0 will ruin your security; use it only for testing"),this.B=e},addEntropy:function(e,t,n){n=n||"user";var o,i,r=(new Date).valueOf(),c=this.s[n],a=this.isReady(),l=0;switch(o=this.K[n],o===s&&(o=this.K[n]=this.W++),c===s&&(c=this.s[n]=0),this.s[n]=(this.s[n]+1)%this.c.length,typeof e){case"number":t===s&&(t=1),this.c[c].update([o,this.C++,1,t,r,1,0|e]);break;case"object":if(n=Object.prototype.toString.call(e),"[object Uint32Array]"===n){for(i=[],n=0;n<e.length;n++)i.push(e[n]);e=i}else for("[object Array]"!==n&&(l=1),n=0;n<e.length&&!l;n++)"number"!=typeof e[n]&&(l=1);if(!l){if(t===s)for(n=t=0;n<e.length;n++)for(i=e[n];i>0;)t++,i>>>=1;this.c[c].update([o,this.C++,2,t,r,e.length].concat(e))}break;case"string":t===s&&(t=e.length),this.c[c].update([o,this.C++,3,t,r,e.length]),this.c[c].update(e);break;default:l=1}l&&q(new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string")),this.i[c]+=t,this.d+=t,a===this.m&&(this.isReady()!==this.m&&C("seeded",Math.max(this.j,this.d)),C("progress",this.getProgress()))},isReady:function(e){return e=this.I[e!==s?e:this.B],this.j&&this.j>=e?this.i[0]>this.R&&(new Date).valueOf()>this.O?this.u|this.t:this.t:this.d>=e?this.u|this.m:this.m},getProgress:function(e){return e=this.I[e?e:this.B],this.j>=e?1:this.d>e?1:this.d/e},startCollectors:function(){this.q||(this.a={loadTimeCollector:D(this,this.aa),mouseCollector:D(this,this.ba),keyboardCollector:D(this,this.$),accelerometerCollector:D(this,this.U),touchCollector:D(this,this.da)},window.addEventListener?(window.addEventListener("load",this.a.loadTimeCollector,u),window.addEventListener("mousemove",this.a.mouseCollector,u),window.addEventListener("keypress",this.a.keyboardCollector,u),window.addEventListener("devicemotion",this.a.accelerometerCollector,u),window.addEventListener("touchmove",this.a.touchCollector,u)):document.attachEvent?(document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)):q(new sjcl.exception.bug("can't attach event")),this.q=!0)},stopCollectors:function(){this.q&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,u),window.removeEventListener("mousemove",this.a.mouseCollector,u),window.removeEventListener("keypress",this.a.keyboardCollector,u),window.removeEventListener("devicemotion",this.a.accelerometerCollector,u),window.removeEventListener("touchmove",this.a.touchCollector,u)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.q=u)},addEventListener:function(e,t){this.w[e][this.V++]=t},removeEventListener:function(e,t){var n,o,i=this.w[e],r=[];for(o in i)i.hasOwnProperty(o)&&i[o]===t&&r.push(o);for(n=0;n<r.length;n++)o=r[n],delete i[o]},$:function(){E(1)},ba:function(e){var t,n;try{t=e.x||e.clientX||e.offsetX||0,n=e.y||e.clientY||e.offsetY||0}catch(o){n=t=0}0!=t&&0!=n&&sjcl.random.addEntropy([t,n],2,"mouse"),E(0)},da:function(e){e=e.touches[0]||e.changedTouches[0],sjcl.random.addEntropy([e.pageX||e.clientX,e.pageY||e.clientY],1,"touch"),E(0)},aa:function(){E(2)},U:function(e){if(e=e.accelerationIncludingGravity.x||e.accelerationIncludingGravity.y||e.accelerationIncludingGravity.z,window.orientation){var t=window.orientation;"number"==typeof t&&sjcl.random.addEntropy(t,1,"accelerometer")}e&&sjcl.random.addEntropy(e,2,"accelerometer"),E(0)}},sjcl.random=new sjcl.prng(6);e:try{var F,G,H,I;if(I="undefined"!=typeof module){var J;if(J=module.exports){var K;try{K=require("crypto")}catch(L){K=null}J=(G=K)&&G.randomBytes}I=J}if(I)F=G.randomBytes(128),F=new Uint32Array(new Uint8Array(F).buffer),sjcl.random.addEntropy(F,1024,"crypto['randomBytes']");else if("undefined"!=typeof window&&"undefined"!=typeof Uint32Array){if(H=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(H);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)break e;window.msCrypto.getRandomValues(H)}sjcl.random.addEntropy(H,1024,"crypto['getRandomValues']")}}catch(M){"undefined"!=typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(M))}sjcl.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},Y:function(e,t,n,o){n=n||{},o=o||{};var i,r=sjcl.json,c=r.e({iv:sjcl.random.randomWords(4,0)},r.defaults);return r.e(c,n),n=c.adata,"string"==typeof c.salt&&(c.salt=sjcl.codec.base64.toBits(c.salt)),"string"==typeof c.iv&&(c.iv=sjcl.codec.base64.toBits(c.iv)),(!sjcl.mode[c.mode]||!sjcl.cipher[c.cipher]||"string"==typeof e&&100>=c.iter||64!==c.ts&&96!==c.ts&&128!==c.ts||128!==c.ks&&192!==c.ks&&256!==c.ks||2>c.iv.length||4<c.iv.length)&&q(new sjcl.exception.invalid("json encrypt: invalid parameters")),"string"==typeof e?(i=sjcl.misc.cachedPbkdf2(e,c),e=i.key.slice(0,c.ks/32),c.salt=i.salt):sjcl.ecc&&e instanceof sjcl.ecc.elGamal.publicKey&&(i=e.kem(),c.kemtag=i.tag,e=i.key.slice(0,c.ks/32)),"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t)),"string"==typeof n&&(c.adata=n=sjcl.codec.utf8String.toBits(n)),i=new sjcl.cipher[c.cipher](e),r.e(o,c),o.key=e,c.ct=sjcl.mode[c.mode].encrypt(i,t,c.iv,n,c.ts),c},encrypt:function(e,t,n,o){var i=sjcl.json,r=i.Y.apply(i,arguments);return i.encode(r)},X:function(e,t,n,o){n=n||{},o=o||{};var i=sjcl.json;t=i.e(i.e(i.e({},i.defaults),t),n,!0);var r,c;return r=t.adata,"string"==typeof t.salt&&(t.salt=sjcl.codec.base64.toBits(t.salt)),"string"==typeof t.iv&&(t.iv=sjcl.codec.base64.toBits(t.iv)),(!sjcl.mode[t.mode]||!sjcl.cipher[t.cipher]||"string"==typeof e&&100>=t.iter||64!==t.ts&&96!==t.ts&&128!==t.ts||128!==t.ks&&192!==t.ks&&256!==t.ks||!t.iv||2>t.iv.length||4<t.iv.length)&&q(new sjcl.exception.invalid("json decrypt: invalid parameters")),"string"==typeof e?(c=sjcl.misc.cachedPbkdf2(e,t),e=c.key.slice(0,t.ks/32),t.salt=c.salt):sjcl.ecc&&e instanceof sjcl.ecc.elGamal.secretKey&&(e=e.unkem(sjcl.codec.base64.toBits(t.kemtag)).slice(0,t.ks/32)),"string"==typeof r&&(r=sjcl.codec.utf8String.toBits(r)),c=new sjcl.cipher[t.cipher](e),r=sjcl.mode[t.mode].decrypt(c,t.ct,t.iv,r,t.ts),i.e(o,t),o.key=e,1===n.raw?r:sjcl.codec.utf8String.fromBits(r)},decrypt:function(e,t,n,o){var i=sjcl.json;return i.X(e,i.decode(t),n,o)},encode:function(e){var t,n="{",o="";for(t in e)if(e.hasOwnProperty(t))switch(t.match(/^[a-z0-9]+$/i)||q(new sjcl.exception.invalid("json encode: invalid property name")),n+=o+'"'+t+'":',o=",",typeof e[t]){case"number":case"boolean":n+=e[t];break;case"string":n+='"'+escape(e[t])+'"';break;case"object":n+='"'+sjcl.codec.base64.fromBits(e[t],0)+'"';break;default:q(new sjcl.exception.bug("json encode: unsupported type"))}return n+"}"},decode:function(e){e=e.replace(/\s/g,""),e.match(/^\{.*\}$/)||q(new sjcl.exception.invalid("json decode: this isn't json!")),e=e.replace(/^\{|\}$/g,"").split(/,/);var t,n,o={};for(t=0;t<e.length;t++)(n=e[t].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i))||q(new sjcl.exception.invalid("json decode: this isn't json!")),n[3]?o[n[2]]=parseInt(n[3],10):n[4]?o[n[2]]=n[2].match(/^(ct|adata|salt|iv)$/)?sjcl.codec.base64.toBits(n[4]):unescape(n[4]):n[5]&&(o[n[2]]="true"===n[5]);return o},e:function(e,t,n){if(e===s&&(e={}),t===s)return e;for(var o in t)t.hasOwnProperty(o)&&(n&&e[o]!==s&&e[o]!==t[o]&&q(new sjcl.exception.invalid("required parameter overridden")),e[o]=t[o]);return e},fa:function(e,t){var n,o={};for(n in e)e.hasOwnProperty(n)&&e[n]!==t[n]&&(o[n]=e[n]);return o},ea:function(e,t){var n,o={};for(n=0;n<t.length;n++)e[t[n]]!==s&&(o[t[n]]=e[t[n]]);return o}},sjcl.encrypt=sjcl.json.encrypt,sjcl.decrypt=sjcl.json.decrypt,sjcl.misc.ca={},sjcl.misc.cachedPbkdf2=function(e,t){var n,o=sjcl.misc.ca;return t=t||{},n=t.iter||1e3,o=o[e]=o[e]||{},n=o[n]=o[n]||{firstSalt:t.salt&&t.salt.length?t.salt.slice(0):sjcl.random.randomWords(2,0)},o=t.salt===s?n.firstSalt:t.salt,n[o]=n[o]||sjcl.misc.pbkdf2(e,o,t.iter),{key:n[o].slice(0),salt:o.slice(0)}};var glue=function(e,t){var n,o,i,r,c,s,a,l,u=function(){var n,o={};return o.open=function(){try{var i;i=e.match("^https://")?"wss"+e.substr(5):"ws"+e.substr(4),i+=t.baseURL+"ws",n=new WebSocket(i),n.onmessage=function(e){o.onMessage(e.data.toString())},n.onerror=function(e){var t="the websocket closed the connection with ";t+=e.code?"the error code: "+e.code:"an error.",o.onError(t)},n.onclose=function(){o.onClose()},n.onopen=function(){o.onOpen()}}catch(r){o.onError()}},o.send=function(e){n.send(e)},o.reset=function(){n&&n.close(),n=void 0},o},d=function(){var n,o,i,r=e+t.baseURL+"ajax",c=8e3,s=45e3,a={Timeout:"t",Closed:"c"},l={Delimiter:"&",Init:"i",Push:"u",Poll:"o"},u={},d=!1,h=!1,f=function(){i=function(){},d&&d.abort(),h&&h.abort()},g=function(){f(),u.onClose()},p=function(e){f(),e=e?"the ajax socket closed the connection with the error: "+e:"the ajax socket closed the connection with an error.",u.onError(e)},m=function(e,t){h=$.ajax({url:r,success:function(e){h=!1,t&&t(e)},error:function(e,t){h=!1,p(t)},type:"POST",data:e,dataType:"text",timeout:c})};return i=function(){d=$.ajax({url:r,success:function(e){if(d=!1,e==a.Timeout)return void i();if(e==a.Closed)return void g();var t=e.indexOf(l.Delimiter);return 0>t?void p("ajax socket: failed to split poll token from data!"):(o=e.substring(0,t),e=e.substr(t+1),i(),void u.onMessage(e))},error:function(e,t){d=!1,p(t)},type:"POST",data:l.Poll+n+l.Delimiter+o,dataType:"text",timeout:s})},u.open=function(){m(l.Init,function(e){var t=e.indexOf(l.Delimiter);return 0>t?void p("ajax socket: failed to split uid and poll token from data!"):(n=e.substring(0,t),o=e.substr(t+1),i(),void u.onOpen())})},u.send=function(e){m(l.Push+n+l.Delimiter+e)},u.reset=function(){f()},u},h="1.8.0",f="m",g={WebSocket:"WebSocket",AjaxSocket:"AjaxSocket"},p={Len:2,Init:"in",Ping:"pi",Pong:"po",Close:"cl",Invalid:"iv",DontAutoReconnect:"dr",ChannelData:"cd"},m={Disconnected:"disconnected",Connecting:"connecting",Reconnecting:"reconnecting",Connected:"connected"},v={baseURL:"/glue/",forceSocketType:!1,connectTimeout:1e4,pingInterval:35e3,pingReconnectTimeout:5e3,reconnect:!0,reconnectDelay:1e3,reconnectDelayMax:5e3,reconnectAttempts:10,resetSendBufferTimeout:1e4},y=!1,b=!1,j=m.Disconnected,w=0,k=!1,C=!1,x=!1,A=!1,S=[],T=!1,D=!1,L=!1,M=[],I="",B=function(){var e="&",t={};return t.unmarshalValues=function(t){if(!t)return!1;var n=t.indexOf(e),o=parseInt(t.substring(0,n),10);if(t=t.substring(n+1),0>o||o>t.length)return!1;var i=t.substr(0,o),r=t.substr(o);return{first:i,second:r}},t.marshalValues=function(t,n){return String(t.length)+e+t+n},t}(),O=function(){var e={},t={},n=function(e){var t={onMessageFunc:function(){}};return t.instance={onMessage:function(e){t.onMessageFunc=e},send:function(t,n){return t?s(p.ChannelData,B.marshalValues(e,t),n):-1}},t};return e.get=function(e){if(!e)return!1;var o=t[e];return o?o.instance:(o=n(e),t[e]=o,o.instance)},e.emitOnMessage=function(e,n){if(e&&n){var o=t[e];if(!o)return void console.log("glue: channel '"+e+"': emit onMessage event: channel does not exists");try{o.onMessageFunc(n)}catch(i){return void console.log("glue: channel '"+e+"': onMessage event call failed: "+i.message)}}},e}();c=function(e){return y?L?void y.send(e):void M.push(e):void 0};var E=function(){if(0!==M.length){for(var e=0;e<M.length;e++)c(M[e]);M=[]}},q=function(){D=!1,T!==!1&&(clearTimeout(T),T=!1)},R=function(){T!==!1||D||(T=setTimeout(function(){if(T=!1,D=!0,0!==S.length){for(var e,t=0;t<S.length;t++)if(e=S[t],e.discardCallback&&$.isFunction(e.discardCallback))try{e.discardCallback(e.data)}catch(n){console.log("glue: failed to call discard callback: "+n.message)}l("discard_send_buffer"),S=[]}},t.resetSendBufferTimeout))},P=function(){if(q(),0!==S.length){for(var e,t=0;t<S.length;t++)e=S[t],c(e.cmd+e.data);S=[]}};s=function(e,t,n){return t||(t=""),y&&j===m.Connected?(c(e+t),1):D?(n&&$.isFunction(n)&&n(t),-1):(R(),S.push({cmd:e,data:t,discardCallback:n}),0)};var U=function(){C!==!1&&(clearTimeout(C),C=!1)},F=function(){U(),C=setTimeout(function(){C=!1,l("connect_timeout"),a()},t.connectTimeout)},N=function(){x!==!1&&(clearTimeout(x),x=!1),A!==!1&&(clearTimeout(A),A=!1)},_=function(){N(),x=setTimeout(function(){x=!1,c(p.Ping),A=setTimeout(function(){A=!1,l("timeout"),a()},t.pingReconnectTimeout)},t.pingInterval)},z=function(){return b?void(y=o()):w>1?(o=d,y=o(),void(i=g.AjaxSocket)):(!t.forceSocketType&&window.WebSocket||t.forceSocketType===g.WebSocket?(o=u,i=g.WebSocket):(o=d,i=g.AjaxSocket),void(y=o()))},G=function(e){return e=JSON.parse(e),e.socketID?(I=e.socketID,L=!0,E(),j=m.Connected,l("connected"),void setTimeout(P,0)):(r(),void console.log("glue: socket initialization failed: invalid initialization data received"))},J=function(){z(),y.onOpen=function(){U(),w=0,b=!0,_();var e={version:h};e=JSON.stringify(e),y.send(p.Init+e)},y.onClose=function(){a()},y.onError=function(e){l("error",[e]),a()},y.onMessage=function(e){if(_(),e.length<p.Len)return void console.log("glue: received invalid data from server: data is too short.");var t=e.substr(0,p.Len);if(e=e.substr(p.Len),t===p.Ping)c(p.Pong);else if(t===p.Pong);else if(t===p.Invalid)console.log("glue: server replied with an invalid request notification!");else if(t===p.DontAutoReconnect)k=!0,console.log("glue: server replied with an don't automatically reconnect request. This might be due to an incompatible protocol version.");else if(t===p.Init)G(e);else if(t===p.ChannelData){var n=B.unmarshalValues(e);if(!n)return void console.log("glue: server requested an invalid channel data request: "+e);O.emitOnMessage(n.first,n.second)}else console.log("glue: received invalid data from server with command '"+t+"' and data '"+e+"'!")},setTimeout(function(){w>0?(j=m.Reconnecting,l("reconnecting")):(j=m.Connecting,l("connecting")),F(),y.open()},0)},V=function(){U(),N(),L=!1,I="",M=[],y&&(y.onOpen=y.onClose=y.onMessage=y.onError=function(){},y.reset(),y=!1)};if(a=function(){if(V(),t.reconnectAttempts>0&&w>t.reconnectAttempts||t.reconnect===!1||k)return j=m.Disconnected,void l("disconnected");w+=1;var e=t.reconnectDelay*w;e>t.reconnectDelayMax&&(e=t.reconnectDelayMax),setTimeout(function(){J()},e)},r=function(){y&&(c(p.Close),V(),j=m.Disconnected,l("disconnected"))},n=O.get(f),e||(e=window.location.protocol+"//"+window.location.host),!e.match("^http://")&&!e.match("^https://"))return void console.log("glue: invalid host: missing 'http://' or 'https://'!");t=$.extend(v,t),t.reconnectDelayMax<t.reconnectDelay&&(t.reconnectDelayMax=t.reconnectDelay),0!==t.baseURL.indexOf("/")&&(t.baseURL="/"+t.baseURL),"/"!==t.baseURL.slice(-1)&&(t.baseURL=t.baseURL+"/"),J();var W={version:function(){return h},type:function(){return i},state:function(){return j},socketID:function(){return I},send:function(e,t){n.send(e,t)},onMessage:function(e){n.onMessage(e)},on:function(){var e=$(W);e.on.apply(e,arguments)},reconnect:function(){j===m.Disconnected&&(w=0,k=!1,a())},close:function(){r()},channel:function(e){return O.get(e)}};return l=function(){var e=$(W);e.triggerHandler.apply(e,arguments)},W};Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=n.length;return function(i){if("object"!=typeof i&&("function"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var r,c,s=[];for(r in i)e.call(i,r)&&s.push(r);if(t)for(c=0;o>c;c++)e.call(i,n[c])&&s.push(n[c]);return s}}());var BitMonster=function(e){var t={};e||(e="");var n=function(){var e="&",t={},n=function(e,t){var n,o,i,r,c,s,a,l;for(n=3&e.length,o=e.length-n,i=t,c=3432918353,s=461845907,l=0;o>l;)a=255&e.charCodeAt(l)|(255&e.charCodeAt(++l))<<8|(255&e.charCodeAt(++l))<<16|(255&e.charCodeAt(++l))<<24,++l,a=(65535&a)*c+(((a>>>16)*c&65535)<<16)&4294967295,a=a<<15|a>>>17,a=(65535&a)*s+(((a>>>16)*s&65535)<<16)&4294967295,i^=a,i=i<<13|i>>>19,r=5*(65535&i)+((5*(i>>>16)&65535)<<16)&4294967295,i=(65535&r)+27492+(((r>>>16)+58964&65535)<<16);switch(a=0,n){case 3:a^=(255&e.charCodeAt(l+2))<<16;case 2:a^=(255&e.charCodeAt(l+1))<<8;case 1:a^=255&e.charCodeAt(l),a=(65535&a)*c+(((a>>>16)*c&65535)<<16)&4294967295,a=a<<15|a>>>17,a=(65535&a)*s+(((a>>>16)*s&65535)<<16)&4294967295,i^=a}return i^=e.length,i^=i>>>16,i=2246822507*(65535&i)+((2246822507*(i>>>16)&65535)<<16)&4294967295,i^=i>>>13,i=3266489909*(65535&i)+((3266489909*(i>>>16)&65535)<<16)&4294967295,i^=i>>>16,i>>>0};return t.storageAvailable=function(e){try{var t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(o){return!1}},t.callCatch=function(e){Array.prototype.shift.call(arguments);try{e.apply(e,arguments)}catch(t){console.log("BitMonster: catched exception while calling callback:"),console.log(t)}},t.randomString=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;e>o;o++)t+=n.charAt(Math.floor(Math.random()*n.length));

return t},t.unmarshalValues=function(t){if(!t)return!1;var n=t.indexOf(e),o=parseInt(t.substring(0,n),10);if(t=t.substring(n+1),0>o||o>t.length)return!1;var i=t.substr(0,o),r=t.substr(o);return{first:i,second:r}},t.marshalValues=function(t,n){return String(t.length)+e+t+n},t.browserFingerprint=function(){var e=[navigator.userAgent,(new Date).getTimezoneOffset(),!!window.sessionStorage,!!window.localStorage,$.map(navigator.plugins,function(e){return[e.name,e.description,$.map(e,function(e){return[e.type,e.suffixes].join("~")}).join(",")].join("::")}).join(";")].join("###");return String(n(e,2155905152))},t.cookies={getItem:function(e){return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(e,t,n,o,i,r){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var c="";if(n)switch(n.constructor){case Number:c=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:c="; expires="+n;break;case Date:c="; expires="+n.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+c+(i?"; domain="+i:"")+(o?"; path="+o:"")+(r?"; secure":""),!0},removeItem:function(e,t,n){return this.hasItem(e)?(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(t?"; path="+t:""),!0):!1},hasItem:function(e){return e?new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie):!1},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=e.length,n=0;t>n;n++)e[n]=decodeURIComponent(e[n]);return e}},t}(),o={en:{socket:{ConnLostTitle:"Connection Lost",ConnLostText:"Trying to reconnect to Server...",DiscardNotSendDataTitle:"Unsend Data",DiscardNotSendDataText:"Not all data messages could be transmitted to the server!",DisconnectedTitle:"Disconnected from Server",DisconnectedText:"Click here to reconnect."},auth:{FailedTitle:"Authentication failed",FailedText:"Failed to authenticate this session."}}},i=o.en,r=(navigator.language||navigator.browserLanguage).split("-")[0];r&&o[r]&&(i=o[r]),t.notification=function(e){function t(){var t=$("#"+u);return t.length?t:(t=$(h),$("body").prepend(t),e.hideClose?$("#"+u+" > div").remove():$("#"+u+" > div").on("click",function(){e.destroyOnClose?a():s()}),t)}function o(e){t().find("p").text(e)}function i(e){t().find("span").text(e)}function r(){d!==!1&&(clearTimeout(d),d=!1)}function c(e){var n=t();r(),n.removeClass("hide"),n.removeClass("show"),n.addClass("show"),e>0&&(d=setTimeout(function(){d=!1,s()},e))}function s(){var e=t();r(),e.addClass("hide"),d=setTimeout(function(){d=!1,e.removeClass("hide"),e.removeClass("show")},3e3)}function a(){var e=t();r(),e.addClass("hide"),d=setTimeout(function(){d=!1,e.remove()},3e3)}var l={title:"",text:"",destroyOnClose:!0,hideClose:!1},u="bm-notification-"+n.randomString(14),d=!1,h='<div id="'+u+'" class="bm-notification"><div><b></b><b></b><b></b><b></b></div><p></p><span></span></div>';return e=$.extend(l,e),t(),o(e.title),i(e.text),{setTitle:o,setText:i,show:c,hide:s,destroy:a,onClick:function(e){t().addClass("bm-clickable").on("click",e)}}};var c=function(){var e={},n=!1,o=t.notification({title:i.socket.ConnLostTitle,text:i.socket.ConnLostText,destroyOnClose:!1,hideClose:!0});return e.show=function(){n===!1&&(n=setTimeout(function(){n=!1,o.show()},1500))},e.hide=function(){n!==!1&&(clearTimeout(n),n=!1),o.hide()},e}();t.scope=function(){var e={};return function(t){if(!t)return console.log("BitMonster: invalid scope call: scope='"+t+"'"),!1;var n=e[t];n||(n={events:[]});for(var o=1;o<arguments.length;o++){var i=arguments[o];$.isFunction(i.off)?n.events.push(i):console.log("BitMonster: invalid scope call: passed invalid argument: skipping argument...")}return e[t]=n,{off:function(){for(var o=0;o<n.events.length;o++)n.events[o].off();delete e[t]}}}}();var s=function(){var n=glue(e,{baseURL:"/bitmonster/"});return n?(n.on("connected",function(){c.hide()}),n.on("connecting",function(){c.show()}),n.on("reconnecting",function(){c.show()}),n.on("disconnected",function(){c.hide();var e=t.notification({title:i.socket.DisconnectedTitle,text:i.socket.DisconnectedText,hideClose:!0});e.onClick(function(){e.destroy(),n.reconnect()}),e.show()}),n.on("error",function(e,t){console.log("BitMonster: socket error: "+t)}),n.on("discard_send_buffer",function(){t.notification({title:i.socket.DiscardNotSendDataTitle,text:i.socket.DiscardNotSendDataText}).show()}),n):void console.log("BitMonster: failed to initialize socket!")}();return t.module=function(){var e=14,t=10,o=12e3,i=s.channel("call"),r=s.channel("event"),c={},a={};i.onMessage(function(e){var t=function(){console.log("BitMonster: received invalid call request from server.")};if(e=JSON.parse(e),!e.callbackID||0===String(e.callbackID).length)return void t();var o=c[e.callbackID];return o?(delete c[e.callbackID],o.timeout&&(clearTimeout(o.timeout),o.timeout=!1),void("cleanup"!==e.type&&("success"===e.type&&o.success?n.callCatch(o.success,e.data):"error"===e.type&&o.error?n.callCatch(o.error,e.message):t()))):void t()}),r.onMessage(function(e){var t=function(){console.log("BitMonster: received invalid event request from server.")};if(e=JSON.parse(e),!e.module||!e.event)return void t();var n=a[e.module];if(n){var o=n.events[e.event];if(o)if("trigger"===e.type){var i;e.data&&(i=JSON.parse(e.data));var r=jQuery.extend({},o.listeners);$.each(r,function(e,t){try{t.callback(i)}catch(n){console.log("BitMonster: catched exception while triggering event:"),console.log(n)}})}else t()}});var l=function(t,r){var s=!1,a=!1,l=!1,u=function(){console.log("BitMonster: invalid method call: module='"+t+"' method='"+r+"'")};if(!r)return u(),!1;for(var d=2;d<arguments.length;d++){var h=arguments[d];if(null!==h&&"object"==typeof h){if(s!==!1)return u(),!1;s=h}else{if(!$.isFunction(h))return u(),!1;if(a===!1)a=h;else{if(l!==!1)return u(),!1;l=h}}}s=s?JSON.stringify(s):"";var f={module:t,method:r};if(a!==!1||l!==!1){for(var g;;)if(g=n.randomString(e),!c[g])break;var p={success:a,error:l};p.timeout=setTimeout(function(){p.timeout=!1,delete c[g],p.error&&p.error("method call timeout: no server response received within the timeout")},o),c[g]=p,f.callbackID=g,f.callbackSuccess=a!==!1,f.callbackError=l!==!1}return f=JSON.stringify(f),i.send(n.marshalValues(f,s)),!0},u=function(e,t,n){var o=a[e];if(o){var i=o.events[t];if(i&&(delete i.listeners[n],!(Object.keys(i.listeners).length>0))){delete o.events[t];var c={type:"off",module:e,event:t};c=JSON.stringify(c),r.send(c)}}},d=function(e,t){var n={type:"on",module:e,event:t};n=JSON.stringify(n),r.send(n)},h=function(e,o,i){var r=a[e];r||(r={events:{}},a[e]=r);var c=r.events[o];c||(c={listeners:{}},r.events[o]=c);for(var s;;)if(s=n.randomString(t),!c.listeners[s])break;return c.listeners[s]={callback:i},1==Object.keys(c.listeners).length&&d(e,o,s),{off:function(){u(e,o,s)}}};return $(s).on("connected_and_auth",function(){$.each(a,function(e,t){$.each(t.events,function(t,n){d(e,t)})})}),function(e){return e?{call:function(){return Array.prototype.unshift.call(arguments,e),l.apply(l,arguments)},on:function(){return Array.prototype.unshift.call(arguments,e),h.apply(h,arguments)}}:(console.log("BitMonster: invalid module call: module='"+e+"'"),!1)}}(),t.auth=function(){function e(){return m||(m=n.browserFingerprint()),m}function o(){var t;return n.storageAvailable("localStorage")?t=localStorage[g]:n.cookies.hasItem(g)&&(t=n.cookies.getItem(g)),t?t=sjcl.decrypt(e(),t):""}function r(t){t=sjcl.encrypt(e(),t),n.storageAvailable("localStorage")?localStorage.setItem(g,t):n.cookies.setItem(g,t,2592e3)}function c(){n.storageAvailable("localStorage")?localStorage.removeItem(g):n.cookies.removeItem(g)}function a(t,i){var s=o();if(!s)return!1;var a=function(e){d(!1),c(),i&&(n.callCatch(i,e),i=void 0)},l={token:s,fingerprint:e()},h=function(e){return e.user&&e.user.id?(e.token&&r(e.token),d(e.user.id),void(t&&n.callCatch(t))):(a("invalid user data received"),void u())};return p.call("authenticate",l,h,function(e){p.call("authenticate",l,h,function(e){a(e)})}),!0}function l(t,o,i,c){var l=function(){var s=function(e){c&&(n.callCatch(c,e),c=void 0)};if(!t||!o)return void s("invalid login credentials");var l={username:t,password:o,fingerprint:e()};p.call("login",l,function(e){return e.token?(r(e.token),a(i,c)?void 0:void s("authentication failed")):void s("login failed: invalid authentication token")},function(e){s(e)})};"connected"!==s.state()?s.on("connected",l):l()}function u(){d(!1),c(),p.call("logout",function(){},function(e){console.log("BitMonster: failed to logout socket session"),e&&console.log(e)})}function d(e){v!==e&&(v=e,v?($(y).trigger("authChanged",[!0]),$(y).trigger("onAuth")):$(y).trigger("authChanged",[!1]))}function h(){return v?v:!1}function f(){return v?!0:!1}var g="BMAuthToken",p=t.module("auth"),m=!1,v=!1,y={login:l,logout:u,getUserID:h,isAuth:f,onAuth:function(e){$(y).on("onAuth",e)},onAuthChanged:function(e){$(y).on("authChanged",e)}};return s.on("connected",function(){var e=a(function(){$(s).trigger("connected_and_auth")},function(e){$(s).trigger("connected_and_auth"),console.log("BitMonster: failed to authenticate"),e&&console.log("error message: "+e),t.notification({title:i.auth.FailedTitle,text:i.auth.FailedText}).show(1e4)});e||$(s).trigger("connected_and_auth")}),p.on("reauthenticate",function(){a(void 0,function(e){console.log("BitMonster: failed to reauthenticate"),e&&console.log("error message: "+e),t.notification({title:i.auth.FailedTitle,text:i.auth.FailedText}).show(1e4)})}),y}(),t};