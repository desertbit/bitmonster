"use strict";function q(t){throw t}function w(t,e,n){4!==e.length&&q(new sjcl.exception.invalid("invalid aes block size"));var o=t.b[n],i=e[0]^o[0],r=e[n?3:1]^o[1],c=e[2]^o[2];e=e[n?1:3]^o[3];var s,a,l,u,d=o.length/4-2,h=4,f=[0,0,0,0];s=t.k[n],t=s[0];var g=s[1],p=s[2],m=s[3],v=s[4];for(u=0;d>u;u++)s=t[i>>>24]^g[r>>16&255]^p[c>>8&255]^m[255&e]^o[h],a=t[r>>>24]^g[c>>16&255]^p[e>>8&255]^m[255&i]^o[h+1],l=t[c>>>24]^g[e>>16&255]^p[i>>8&255]^m[255&r]^o[h+2],e=t[e>>>24]^g[i>>16&255]^p[r>>8&255]^m[255&c]^o[h+3],h+=4,i=s,r=a,c=l;for(u=0;4>u;u++)f[n?3&-u:u]=v[i>>>24]<<24^v[r>>16&255]<<16^v[c>>8&255]<<8^v[255&e]^o[h++],s=i,i=r,r=c,c=e,e=s;return f}function x(t,e){var n,o,i,r=e.slice(0),c=t.r,s=t.b,a=c[0],l=c[1],u=c[2],d=c[3],h=c[4],f=c[5],g=c[6],p=c[7];for(n=0;64>n;n++)16>n?o=r[n]:(o=r[n+1&15],i=r[n+14&15],o=r[15&n]=(o>>>7^o>>>18^o>>>3^o<<25^o<<14)+(i>>>17^i>>>19^i>>>10^i<<15^i<<13)+r[15&n]+r[n+9&15]|0),o=o+p+(h>>>6^h>>>11^h>>>25^h<<26^h<<21^h<<7)+(g^h&(f^g))+s[n],p=g,g=f,f=h,h=d+o|0,d=u,u=l,l=a,a=o+(l&u^d&(l^u))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;c[0]=c[0]+a|0,c[1]=c[1]+l|0,c[2]=c[2]+u|0,c[3]=c[3]+d|0,c[4]=c[4]+h|0,c[5]=c[5]+f|0,c[6]=c[6]+g|0,c[7]=c[7]+p|0}function C(t,e){var n,o=sjcl.random.w[t],i=[];for(n in o)o.hasOwnProperty(n)&&i.push(o[n]);for(n=0;n<i.length;n++)i[n](e)}function E(t){"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?sjcl.random.addEntropy(window.performance.now(),t,"loadtime"):sjcl.random.addEntropy((new Date).valueOf(),t,"loadtime")}function A(t){t.b=B(t).concat(B(t)),t.A=new sjcl.cipher.aes(t.b)}function B(t){for(var e=0;4>e&&(t.f[e]=t.f[e]+1|0,!t.f[e]);e++);return t.A.encrypt(t.f)}function D(t,e){return function(){e.apply(t,arguments)}}var s=void 0,u=!1,sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};"undefined"!=typeof module&&module.exports&&(module.exports=sjcl),"function"==typeof define&&define([],function(){return sjcl}),sjcl.cipher.aes=function(t){this.k[0][0][0]||this.D();var e,n,o,i,r=this.k[0][4],c=this.k[1];e=t.length;var s=1;for(4!==e&&6!==e&&8!==e&&q(new sjcl.exception.invalid("invalid aes key size")),this.b=[o=t.slice(0),i=[]],t=e;4*e+28>t;t++)n=o[t-1],(0===t%e||8===e&&4===t%e)&&(n=r[n>>>24]<<24^r[n>>16&255]<<16^r[n>>8&255]<<8^r[255&n],0===t%e&&(n=n<<8^n>>>24^s<<24,s=s<<1^283*(s>>7))),o[t]=o[t-e]^n;for(e=0;t;e++,t--)n=o[3&e?t:t-4],i[e]=4>=t||4>e?n:c[0][r[n>>>24]]^c[1][r[n>>16&255]]^c[2][r[n>>8&255]]^c[3][r[255&n]]},sjcl.cipher.aes.prototype={encrypt:function(t){return w(this,t,0)},decrypt:function(t){return w(this,t,1)},k:[[[],[],[],[],[]],[[],[],[],[],[]]],D:function(){var t,e,n,o,i,r,c,s=this.k[0],a=this.k[1],l=s[4],u=a[4],d=[],h=[];for(t=0;256>t;t++)h[(d[t]=t<<1^283*(t>>7))^t]=t;for(e=n=0;!l[e];e^=o||1,n=h[n]||1)for(r=n^n<<1^n<<2^n<<3^n<<4,r=r>>8^255&r^99,l[e]=r,u[r]=e,i=d[t=d[o=d[e]]],c=16843009*i^65537*t^257*o^16843008*e,i=257*d[r]^16843008*r,t=0;4>t;t++)s[t][e]=i=i<<24^i>>>8,a[t][r]=c=c<<24^c>>>8;for(t=0;5>t;t++)s[t]=s[t].slice(0),a[t]=a[t].slice(0)}},sjcl.bitArray={bitSlice:function(t,e,n){return t=sjcl.bitArray.P(t.slice(e/32),32-(31&e)).slice(1),n===s?t:sjcl.bitArray.clamp(t,n-e)},extract:function(t,e,n){var o=Math.floor(-e-n&31);return(-32&(e+n-1^e)?t[e/32|0]<<32-o^t[e/32+1|0]>>>o:t[e/32|0]>>>o)&(1<<n)-1},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var n=t[t.length-1],o=sjcl.bitArray.getPartial(n);return 32===o?t.concat(e):sjcl.bitArray.P(e,o,0|n,t.slice(0,t.length-1))},bitLength:function(t){var e=t.length;return 0===e?0:32*(e-1)+sjcl.bitArray.getPartial(t[e-1])},clamp:function(t,e){if(32*t.length<e)return t;t=t.slice(0,Math.ceil(e/32));var n=t.length;return e&=31,n>0&&e&&(t[n-1]=sjcl.bitArray.partial(e,t[n-1]&2147483648>>e-1,1)),t},partial:function(t,e,n){return 32===t?e:(n?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(sjcl.bitArray.bitLength(t)!==sjcl.bitArray.bitLength(e))return u;var n,o=0;for(n=0;n<t.length;n++)o|=t[n]^e[n];return 0===o},P:function(t,e,n,o){var i;for(i=0,o===s&&(o=[]);e>=32;e-=32)o.push(n),n=0;if(0===e)return o.concat(t);for(i=0;i<t.length;i++)o.push(n|t[i]>>>e),n=t[i]<<32-e;return i=t.length?t[t.length-1]:0,t=sjcl.bitArray.getPartial(i),o.push(sjcl.bitArray.partial(e+t&31,e+t>32?n:o.pop(),1)),o},l:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]},byteswapM:function(t){var e,n;for(e=0;e<t.length;++e)n=t[e],t[e]=n>>>24|n>>>8&65280|(65280&n)<<8|n<<24;return t}},sjcl.codec.utf8String={fromBits:function(t){var e,n,o="",i=sjcl.bitArray.bitLength(t);for(e=0;i/8>e;e++)0===(3&e)&&(n=t[e/4]),o+=String.fromCharCode(n>>>24),n<<=8;return decodeURIComponent(escape(o))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,n=[],o=0;for(e=0;e<t.length;e++)o=o<<8|t.charCodeAt(e),3===(3&e)&&(n.push(o),o=0);return 3&e&&n.push(sjcl.bitArray.partial(8*(3&e),o)),n}},sjcl.codec.hex={fromBits:function(t){var e,n="";for(e=0;e<t.length;e++)n+=((0|t[e])+0xf00000000000).toString(16).substr(4);return n.substr(0,sjcl.bitArray.bitLength(t)/4)},toBits:function(t){var e,n,o=[];for(t=t.replace(/\s|0x/g,""),n=t.length,t+="00000000",e=0;e<t.length;e+=8)o.push(0^parseInt(t.substr(e,8),16));return sjcl.bitArray.clamp(o,4*n)}},sjcl.codec.base64={J:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,n){var o="",i=0,r=sjcl.codec.base64.J,c=0,s=sjcl.bitArray.bitLength(t);for(n&&(r=r.substr(0,62)+"-_"),n=0;6*o.length<s;)o+=r.charAt((c^t[n]>>>i)>>>26),6>i?(c=t[n]<<6-i,i+=26,n++):(c<<=6,i-=6);for(;3&o.length&&!e;)o+="=";return o},toBits:function(t,e){t=t.replace(/\s|=/g,"");var n,o,i=[],r=0,c=sjcl.codec.base64.J,s=0;for(e&&(c=c.substr(0,62)+"-_"),n=0;n<t.length;n++)o=c.indexOf(t.charAt(n)),0>o&&q(new sjcl.exception.invalid("this isn't base64!")),r>26?(r-=26,i.push(s^o>>>r),s=o<<32-r):(r+=6,s^=o<<32-r);return 56&r&&i.push(sjcl.bitArray.partial(56&r,s,1)),i}},sjcl.codec.base64url={fromBits:function(t){return sjcl.codec.base64.fromBits(t,1,1)},toBits:function(t){return sjcl.codec.base64.toBits(t,1)}},sjcl.hash.sha256=function(t){this.b[0]||this.D(),t?(this.r=t.r.slice(0),this.o=t.o.slice(0),this.h=t.h):this.reset()},sjcl.hash.sha256.hash=function(t){return(new sjcl.hash.sha256).update(t).finalize()},sjcl.hash.sha256.prototype={blockSize:512,reset:function(){return this.r=this.N.slice(0),this.o=[],this.h=0,this},update:function(t){"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t));var e,n=this.o=sjcl.bitArray.concat(this.o,t);for(e=this.h,t=this.h=e+sjcl.bitArray.bitLength(t),e=512+e&-512;t>=e;e+=512)x(this,n.splice(0,16));return this},finalize:function(){var t,e=this.o,n=this.r,e=sjcl.bitArray.concat(e,[sjcl.bitArray.partial(1,1)]);for(t=e.length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this.h/4294967296)),e.push(0|this.h);e.length;)x(this,e.splice(0,16));return this.reset(),n},N:[],b:[],D:function(){function t(t){return 4294967296*(t-Math.floor(t))|0}var e,n=0,o=2;t:for(;64>n;o++){for(e=2;o>=e*e;e++)if(0===o%e)continue t;8>n&&(this.N[n]=t(Math.pow(o,.5))),this.b[n]=t(Math.pow(o,1/3)),n++}}},sjcl.mode.ccm={name:"ccm",encrypt:function(t,e,n,o,i){var r,c=e.slice(0),s=sjcl.bitArray,a=s.bitLength(n)/8,l=s.bitLength(c)/8;for(i=i||64,o=o||[],7>a&&q(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes")),r=2;4>r&&l>>>8*r;r++);return 15-a>r&&(r=15-a),n=s.clamp(n,8*(15-r)),e=sjcl.mode.ccm.L(t,e,n,o,i,r),c=sjcl.mode.ccm.p(t,c,n,e,i,r),s.concat(c.data,c.tag)},decrypt:function(t,e,n,o,i){i=i||64,o=o||[];var r=sjcl.bitArray,c=r.bitLength(n)/8,s=r.bitLength(e),a=r.clamp(e,s-i),l=r.bitSlice(e,s-i),s=(s-i)/8;for(7>c&&q(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes")),e=2;4>e&&s>>>8*e;e++);return 15-c>e&&(e=15-c),n=r.clamp(n,8*(15-e)),a=sjcl.mode.ccm.p(t,a,n,l,i,e),t=sjcl.mode.ccm.L(t,a.data,n,o,i,e),r.equal(a.tag,t)||q(new sjcl.exception.corrupt("ccm: tag doesn't match")),a.data},L:function(t,e,n,o,i,r){var c=[],s=sjcl.bitArray,a=s.l;if(i/=8,(i%2||4>i||i>16)&&q(new sjcl.exception.invalid("ccm: invalid tag length")),(4294967295<o.length||4294967295<e.length)&&q(new sjcl.exception.bug("ccm: can't deal with 4GiB or more data")),r=[s.partial(8,(o.length?64:0)|i-2<<2|r-1)],r=s.concat(r,n),r[3]|=s.bitLength(e)/8,r=t.encrypt(r),o.length)for(n=s.bitLength(o)/8,65279>=n?c=[s.partial(16,n)]:4294967295>=n&&(c=s.concat([s.partial(16,65534)],[n])),c=s.concat(c,o),o=0;o<c.length;o+=4)r=t.encrypt(a(r,c.slice(o,o+4).concat([0,0,0])));for(o=0;o<e.length;o+=4)r=t.encrypt(a(r,e.slice(o,o+4).concat([0,0,0])));return s.clamp(r,8*i)},p:function(t,e,n,o,i,r){var c,s=sjcl.bitArray;c=s.l;var a=e.length,l=s.bitLength(e);if(n=s.concat([s.partial(8,r-1)],n).concat([0,0,0]).slice(0,4),o=s.bitSlice(c(o,t.encrypt(n)),0,i),!a)return{tag:o,data:[]};for(c=0;a>c;c+=4)n[3]++,i=t.encrypt(n),e[c]^=i[0],e[c+1]^=i[1],e[c+2]^=i[2],e[c+3]^=i[3];return{tag:o,data:s.clamp(e,l)}}},sjcl.mode.ocb2={name:"ocb2",encrypt:function(t,e,n,o,i,r){128!==sjcl.bitArray.bitLength(n)&&q(new sjcl.exception.invalid("ocb iv must be 128 bits"));var c,s=sjcl.mode.ocb2.H,a=sjcl.bitArray,l=a.l,u=[0,0,0,0];n=s(t.encrypt(n));var d,h=[];for(o=o||[],i=i||64,c=0;c+4<e.length;c+=4)d=e.slice(c,c+4),u=l(u,d),h=h.concat(l(n,t.encrypt(l(n,d)))),n=s(n);return d=e.slice(c),e=a.bitLength(d),c=t.encrypt(l(n,[0,0,0,e])),d=a.clamp(l(d.concat([0,0,0]),c),e),u=l(u,l(d.concat([0,0,0]),c)),u=t.encrypt(l(u,l(n,s(n)))),o.length&&(u=l(u,r?o:sjcl.mode.ocb2.pmac(t,o))),h.concat(a.concat(d,a.clamp(u,i)))},decrypt:function(t,e,n,o,i,r){128!==sjcl.bitArray.bitLength(n)&&q(new sjcl.exception.invalid("ocb iv must be 128 bits")),i=i||64;var c,s,a=sjcl.mode.ocb2.H,l=sjcl.bitArray,u=l.l,d=[0,0,0,0],h=a(t.encrypt(n)),f=sjcl.bitArray.bitLength(e)-i,g=[];for(o=o||[],n=0;f/32>n+4;n+=4)c=u(h,t.decrypt(u(h,e.slice(n,n+4)))),d=u(d,c),g=g.concat(c),h=a(h);return s=f-32*n,c=t.encrypt(u(h,[0,0,0,s])),c=u(c,l.clamp(e.slice(n),s).concat([0,0,0])),d=u(d,c),d=t.encrypt(u(d,u(h,a(h)))),o.length&&(d=u(d,r?o:sjcl.mode.ocb2.pmac(t,o))),l.equal(l.clamp(d,i),l.bitSlice(e,f))||q(new sjcl.exception.corrupt("ocb: tag doesn't match")),g.concat(l.clamp(c,s))},pmac:function(t,e){var n,o=sjcl.mode.ocb2.H,i=sjcl.bitArray,r=i.l,c=[0,0,0,0],s=t.encrypt([0,0,0,0]),s=r(s,o(o(s)));for(n=0;n+4<e.length;n+=4)s=o(s),c=r(c,t.encrypt(r(s,e.slice(n,n+4))));return n=e.slice(n),128>i.bitLength(n)&&(s=r(s,o(s)),n=i.concat(n,[-2147483648,0,0,0])),c=r(c,n),t.encrypt(r(o(r(s,o(s))),c))},H:function(t){return[t[0]<<1^t[1]>>>31,t[1]<<1^t[2]>>>31,t[2]<<1^t[3]>>>31,t[3]<<1^135*(t[0]>>>31)]}},sjcl.mode.gcm={name:"gcm",encrypt:function(t,e,n,o,i){var r=e.slice(0);return e=sjcl.bitArray,o=o||[],t=sjcl.mode.gcm.p(!0,t,r,o,n,i||128),e.concat(t.data,t.tag)},decrypt:function(t,e,n,o,i){var r=e.slice(0),c=sjcl.bitArray,s=c.bitLength(r);return i=i||128,o=o||[],s>=i?(e=c.bitSlice(r,s-i),r=c.bitSlice(r,0,s-i)):(e=r,r=[]),t=sjcl.mode.gcm.p(u,t,r,o,n,i),c.equal(t.tag,e)||q(new sjcl.exception.corrupt("gcm: tag doesn't match")),t.data},Z:function(t,e){var n,o,i,r,c,s=sjcl.bitArray.l;for(i=[0,0,0,0],r=e.slice(0),n=0;128>n;n++){for((o=0!==(t[Math.floor(n/32)]&1<<31-n%32))&&(i=s(i,r)),c=0!==(1&r[3]),o=3;o>0;o--)r[o]=r[o]>>>1|(1&r[o-1])<<31;r[0]>>>=1,c&&(r[0]^=-520093696)}return i},g:function(t,e,n){var o,i=n.length;for(e=e.slice(0),o=0;i>o;o+=4)e[0]^=4294967295&n[o],e[1]^=4294967295&n[o+1],e[2]^=4294967295&n[o+2],e[3]^=4294967295&n[o+3],e=sjcl.mode.gcm.Z(e,t);return e},p:function(t,e,n,o,i,r){var c,s,a,l,u,d,h,f,g=sjcl.bitArray;for(d=n.length,h=g.bitLength(n),f=g.bitLength(o),s=g.bitLength(i),c=e.encrypt([0,0,0,0]),96===s?(i=i.slice(0),i=g.concat(i,[1])):(i=sjcl.mode.gcm.g(c,[0,0,0,0],i),i=sjcl.mode.gcm.g(c,i,[0,0,Math.floor(s/4294967296),4294967295&s])),s=sjcl.mode.gcm.g(c,[0,0,0,0],o),u=i.slice(0),o=s.slice(0),t||(o=sjcl.mode.gcm.g(c,s,n)),l=0;d>l;l+=4)u[3]++,a=e.encrypt(u),n[l]^=a[0],n[l+1]^=a[1],n[l+2]^=a[2],n[l+3]^=a[3];return n=g.clamp(n,h),t&&(o=sjcl.mode.gcm.g(c,s,n)),t=[Math.floor(f/4294967296),4294967295&f,Math.floor(h/4294967296),4294967295&h],o=sjcl.mode.gcm.g(c,o,t),a=e.encrypt(i),o[0]^=a[0],o[1]^=a[1],o[2]^=a[2],o[3]^=a[3],{tag:g.bitSlice(o,0,r),data:n}}},sjcl.misc.hmac=function(t,e){this.M=e=e||sjcl.hash.sha256;var n,o=[[],[]],i=e.prototype.blockSize/32;for(this.n=[new e,new e],t.length>i&&(t=e.hash(t)),n=0;i>n;n++)o[0][n]=909522486^t[n],o[1][n]=1549556828^t[n];this.n[0].update(o[0]),this.n[1].update(o[1]),this.G=new e(this.n[0])},sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(t){return this.Q&&q(new sjcl.exception.invalid("encrypt on already updated hmac called!")),this.update(t),this.digest(t)},sjcl.misc.hmac.prototype.reset=function(){this.G=new this.M(this.n[0]),this.Q=u},sjcl.misc.hmac.prototype.update=function(t){this.Q=!0,this.G.update(t)},sjcl.misc.hmac.prototype.digest=function(){var t=this.G.finalize(),t=new this.M(this.n[1]).update(t).finalize();return this.reset(),t},sjcl.misc.pbkdf2=function(t,e,n,o,i){n=n||1e3,(0>o||0>n)&&q(sjcl.exception.invalid("invalid params to pbkdf2")),"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t)),"string"==typeof e&&(e=sjcl.codec.utf8String.toBits(e)),i=i||sjcl.misc.hmac,t=new i(t);var r,c,s,a,l=[],u=sjcl.bitArray;for(a=1;32*l.length<(o||1);a++){for(i=r=t.encrypt(u.concat(e,[a])),c=1;n>c;c++)for(r=t.encrypt(r),s=0;s<r.length;s++)i[s]^=r[s];l=l.concat(i)}return o&&(l=u.clamp(l,o)),l},sjcl.prng=function(t){this.c=[new sjcl.hash.sha256],this.i=[0],this.F=0,this.s={},this.C=0,this.K={},this.O=this.d=this.j=this.W=0,this.b=[0,0,0,0,0,0,0,0],this.f=[0,0,0,0],this.A=s,this.B=t,this.q=u,this.w={progress:{},seeded:{}},this.m=this.V=0,this.t=1,this.u=2,this.S=65536,this.I=[0,48,64,96,128,192,256,384,512,768,1024],this.T=3e4,this.R=80},sjcl.prng.prototype={randomWords:function(t,e){var n,o=[];n=this.isReady(e);var i;if(n===this.m&&q(new sjcl.exception.notReady("generator isn't seeded")),n&this.u){n=!(n&this.t),i=[];var r,c=0;for(this.O=i[0]=(new Date).valueOf()+this.T,r=0;16>r;r++)i.push(4294967296*Math.random()|0);for(r=0;r<this.c.length&&(i=i.concat(this.c[r].finalize()),c+=this.i[r],this.i[r]=0,!(!n&&this.F&1<<r));r++);for(this.F>=1<<this.c.length&&(this.c.push(new sjcl.hash.sha256),this.i.push(0)),this.d-=c,c>this.j&&(this.j=c),this.F++,this.b=sjcl.hash.sha256.hash(this.b.concat(i)),this.A=new sjcl.cipher.aes(this.b),n=0;4>n&&(this.f[n]=this.f[n]+1|0,!this.f[n]);n++);}for(n=0;t>n;n+=4)0===(n+1)%this.S&&A(this),i=B(this),o.push(i[0],i[1],i[2],i[3]);return A(this),o.slice(0,t)},setDefaultParanoia:function(t,e){0===t&&"Setting paranoia=0 will ruin your security; use it only for testing"!==e&&q("Setting paranoia=0 will ruin your security; use it only for testing"),this.B=t},addEntropy:function(t,e,n){n=n||"user";var o,i,r=(new Date).valueOf(),c=this.s[n],a=this.isReady(),l=0;switch(o=this.K[n],o===s&&(o=this.K[n]=this.W++),c===s&&(c=this.s[n]=0),this.s[n]=(this.s[n]+1)%this.c.length,typeof t){case"number":e===s&&(e=1),this.c[c].update([o,this.C++,1,e,r,1,0|t]);break;case"object":if(n=Object.prototype.toString.call(t),"[object Uint32Array]"===n){for(i=[],n=0;n<t.length;n++)i.push(t[n]);t=i}else for("[object Array]"!==n&&(l=1),n=0;n<t.length&&!l;n++)"number"!=typeof t[n]&&(l=1);if(!l){if(e===s)for(n=e=0;n<t.length;n++)for(i=t[n];i>0;)e++,i>>>=1;this.c[c].update([o,this.C++,2,e,r,t.length].concat(t))}break;case"string":e===s&&(e=t.length),this.c[c].update([o,this.C++,3,e,r,t.length]),this.c[c].update(t);break;default:l=1}l&&q(new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string")),this.i[c]+=e,this.d+=e,a===this.m&&(this.isReady()!==this.m&&C("seeded",Math.max(this.j,this.d)),C("progress",this.getProgress()))},isReady:function(t){return t=this.I[t!==s?t:this.B],this.j&&this.j>=t?this.i[0]>this.R&&(new Date).valueOf()>this.O?this.u|this.t:this.t:this.d>=t?this.u|this.m:this.m},getProgress:function(t){return t=this.I[t?t:this.B],this.j>=t?1:this.d>t?1:this.d/t},startCollectors:function(){this.q||(this.a={loadTimeCollector:D(this,this.aa),mouseCollector:D(this,this.ba),keyboardCollector:D(this,this.$),accelerometerCollector:D(this,this.U),touchCollector:D(this,this.da)},window.addEventListener?(window.addEventListener("load",this.a.loadTimeCollector,u),window.addEventListener("mousemove",this.a.mouseCollector,u),window.addEventListener("keypress",this.a.keyboardCollector,u),window.addEventListener("devicemotion",this.a.accelerometerCollector,u),window.addEventListener("touchmove",this.a.touchCollector,u)):document.attachEvent?(document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)):q(new sjcl.exception.bug("can't attach event")),this.q=!0)},stopCollectors:function(){this.q&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,u),window.removeEventListener("mousemove",this.a.mouseCollector,u),window.removeEventListener("keypress",this.a.keyboardCollector,u),window.removeEventListener("devicemotion",this.a.accelerometerCollector,u),window.removeEventListener("touchmove",this.a.touchCollector,u)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.q=u)},addEventListener:function(t,e){this.w[t][this.V++]=e},removeEventListener:function(t,e){var n,o,i=this.w[t],r=[];for(o in i)i.hasOwnProperty(o)&&i[o]===e&&r.push(o);for(n=0;n<r.length;n++)o=r[n],delete i[o]},$:function(){E(1)},ba:function(t){var e,n;try{e=t.x||t.clientX||t.offsetX||0,n=t.y||t.clientY||t.offsetY||0}catch(o){n=e=0}0!=e&&0!=n&&sjcl.random.addEntropy([e,n],2,"mouse"),E(0)},da:function(t){t=t.touches[0]||t.changedTouches[0],sjcl.random.addEntropy([t.pageX||t.clientX,t.pageY||t.clientY],1,"touch"),E(0)},aa:function(){E(2)},U:function(t){if(t=t.accelerationIncludingGravity.x||t.accelerationIncludingGravity.y||t.accelerationIncludingGravity.z,window.orientation){var e=window.orientation;"number"==typeof e&&sjcl.random.addEntropy(e,1,"accelerometer")}t&&sjcl.random.addEntropy(t,2,"accelerometer"),E(0)}},sjcl.random=new sjcl.prng(6);t:try{var F,G,H,I;if(I="undefined"!=typeof module){var J;if(J=module.exports){var K;try{K=require("crypto")}catch(L){K=null}J=(G=K)&&G.randomBytes}I=J}if(I)F=G.randomBytes(128),F=new Uint32Array(new Uint8Array(F).buffer),sjcl.random.addEntropy(F,1024,"crypto['randomBytes']");else if("undefined"!=typeof window&&"undefined"!=typeof Uint32Array){if(H=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(H);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)break t;window.msCrypto.getRandomValues(H)}sjcl.random.addEntropy(H,1024,"crypto['getRandomValues']")}}catch(M){"undefined"!=typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(M))}sjcl.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},Y:function(t,e,n,o){n=n||{},o=o||{};var i,r=sjcl.json,c=r.e({iv:sjcl.random.randomWords(4,0)},r.defaults);return r.e(c,n),n=c.adata,"string"==typeof c.salt&&(c.salt=sjcl.codec.base64.toBits(c.salt)),"string"==typeof c.iv&&(c.iv=sjcl.codec.base64.toBits(c.iv)),(!sjcl.mode[c.mode]||!sjcl.cipher[c.cipher]||"string"==typeof t&&100>=c.iter||64!==c.ts&&96!==c.ts&&128!==c.ts||128!==c.ks&&192!==c.ks&&256!==c.ks||2>c.iv.length||4<c.iv.length)&&q(new sjcl.exception.invalid("json encrypt: invalid parameters")),"string"==typeof t?(i=sjcl.misc.cachedPbkdf2(t,c),t=i.key.slice(0,c.ks/32),c.salt=i.salt):sjcl.ecc&&t instanceof sjcl.ecc.elGamal.publicKey&&(i=t.kem(),c.kemtag=i.tag,t=i.key.slice(0,c.ks/32)),"string"==typeof e&&(e=sjcl.codec.utf8String.toBits(e)),"string"==typeof n&&(c.adata=n=sjcl.codec.utf8String.toBits(n)),i=new sjcl.cipher[c.cipher](t),r.e(o,c),o.key=t,c.ct=sjcl.mode[c.mode].encrypt(i,e,c.iv,n,c.ts),c},encrypt:function(t,e,n,o){var i=sjcl.json,r=i.Y.apply(i,arguments);return i.encode(r)},X:function(t,e,n,o){n=n||{},o=o||{};var i=sjcl.json;e=i.e(i.e(i.e({},i.defaults),e),n,!0);var r,c;return r=e.adata,"string"==typeof e.salt&&(e.salt=sjcl.codec.base64.toBits(e.salt)),"string"==typeof e.iv&&(e.iv=sjcl.codec.base64.toBits(e.iv)),(!sjcl.mode[e.mode]||!sjcl.cipher[e.cipher]||"string"==typeof t&&100>=e.iter||64!==e.ts&&96!==e.ts&&128!==e.ts||128!==e.ks&&192!==e.ks&&256!==e.ks||!e.iv||2>e.iv.length||4<e.iv.length)&&q(new sjcl.exception.invalid("json decrypt: invalid parameters")),"string"==typeof t?(c=sjcl.misc.cachedPbkdf2(t,e),t=c.key.slice(0,e.ks/32),e.salt=c.salt):sjcl.ecc&&t instanceof sjcl.ecc.elGamal.secretKey&&(t=t.unkem(sjcl.codec.base64.toBits(e.kemtag)).slice(0,e.ks/32)),"string"==typeof r&&(r=sjcl.codec.utf8String.toBits(r)),c=new sjcl.cipher[e.cipher](t),r=sjcl.mode[e.mode].decrypt(c,e.ct,e.iv,r,e.ts),i.e(o,e),o.key=t,1===n.raw?r:sjcl.codec.utf8String.fromBits(r)},decrypt:function(t,e,n,o){var i=sjcl.json;return i.X(t,i.decode(e),n,o)},encode:function(t){var e,n="{",o="";for(e in t)if(t.hasOwnProperty(e))switch(e.match(/^[a-z0-9]+$/i)||q(new sjcl.exception.invalid("json encode: invalid property name")),n+=o+'"'+e+'":',o=",",typeof t[e]){case"number":case"boolean":n+=t[e];break;case"string":n+='"'+escape(t[e])+'"';break;case"object":n+='"'+sjcl.codec.base64.fromBits(t[e],0)+'"';break;default:q(new sjcl.exception.bug("json encode: unsupported type"))}return n+"}"},decode:function(t){t=t.replace(/\s/g,""),t.match(/^\{.*\}$/)||q(new sjcl.exception.invalid("json decode: this isn't json!")),t=t.replace(/^\{|\}$/g,"").split(/,/);var e,n,o={};for(e=0;e<t.length;e++)(n=t[e].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i))||q(new sjcl.exception.invalid("json decode: this isn't json!")),n[3]?o[n[2]]=parseInt(n[3],10):n[4]?o[n[2]]=n[2].match(/^(ct|adata|salt|iv)$/)?sjcl.codec.base64.toBits(n[4]):unescape(n[4]):n[5]&&(o[n[2]]="true"===n[5]);return o},e:function(t,e,n){if(t===s&&(t={}),e===s)return t;for(var o in e)e.hasOwnProperty(o)&&(n&&t[o]!==s&&t[o]!==e[o]&&q(new sjcl.exception.invalid("required parameter overridden")),t[o]=e[o]);return t},fa:function(t,e){var n,o={};for(n in t)t.hasOwnProperty(n)&&t[n]!==e[n]&&(o[n]=t[n]);return o},ea:function(t,e){var n,o={};for(n=0;n<e.length;n++)t[e[n]]!==s&&(o[e[n]]=t[e[n]]);return o}},sjcl.encrypt=sjcl.json.encrypt,sjcl.decrypt=sjcl.json.decrypt,sjcl.misc.ca={},sjcl.misc.cachedPbkdf2=function(t,e){var n,o=sjcl.misc.ca;return e=e||{},n=e.iter||1e3,o=o[t]=o[t]||{},n=o[n]=o[n]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):sjcl.random.randomWords(2,0)},o=e.salt===s?n.firstSalt:e.salt,n[o]=n[o]||sjcl.misc.pbkdf2(t,o,e.iter),{key:n[o].slice(0),salt:o.slice(0)}};var glue=function(t,e){var n,o,i,r,c,s,a,l,u=function(){var n,o={};return o.open=function(){try{var i;i=t.match("^https://")?"wss"+t.substr(5):"ws"+t.substr(4),i+=e.baseURL+"ws",n=new WebSocket(i),n.onmessage=function(t){o.onMessage(t.data.toString())},n.onerror=function(t){var e="the websocket closed the connection with ";e+=t.code?"the error code: "+t.code:"an error.",o.onError(e)},n.onclose=function(){o.onClose()},n.onopen=function(){o.onOpen()}}catch(r){o.onError()}},o.send=function(t){n.send(t)},o.reset=function(){n&&n.close(),n=void 0},o},d=function(){var n,o,i,r=t+e.baseURL+"ajax",c=8e3,s=45e3,a={Timeout:"t",Closed:"c"},l={Delimiter:"&",Init:"i",Push:"u",Poll:"o"},u={},d=!1,h=!1,f=function(){i=function(){},d&&d.abort(),h&&h.abort()},g=function(){f(),u.onClose()},p=function(t){f(),t=t?"the ajax socket closed the connection with the error: "+t:"the ajax socket closed the connection with an error.",u.onError(t)},m=function(t,e){h=$.ajax({url:r,success:function(t){h=!1,e&&e(t)},error:function(t,e){h=!1,p(e)},type:"POST",data:t,dataType:"text",timeout:c})};return i=function(){d=$.ajax({url:r,success:function(t){if(d=!1,t==a.Timeout)return void i();if(t==a.Closed)return void g();var e=t.indexOf(l.Delimiter);return 0>e?void p("ajax socket: failed to split poll token from data!"):(o=t.substring(0,e),t=t.substr(e+1),i(),void u.onMessage(t))},error:function(t,e){d=!1,p(e)},type:"POST",data:l.Poll+n+l.Delimiter+o,dataType:"text",timeout:s})},u.open=function(){m(l.Init,function(t){var e=t.indexOf(l.Delimiter);return 0>e?void p("ajax socket: failed to split uid and poll token from data!"):(n=t.substring(0,e),o=t.substr(e+1),i(),void u.onOpen())})},u.send=function(t){m(l.Push+n+l.Delimiter+t)},u.reset=function(){f()},u},h="1.8.1",f="m",g={WebSocket:"WebSocket",AjaxSocket:"AjaxSocket"},p={Len:2,Init:"in",Ping:"pi",Pong:"po",Close:"cl",Invalid:"iv",DontAutoReconnect:"dr",ChannelData:"cd"},m={Disconnected:"disconnected",Connecting:"connecting",Reconnecting:"reconnecting",Connected:"connected"},v={baseURL:"/glue/",forceSocketType:!1,connectTimeout:1e4,pingInterval:35e3,pingReconnectTimeout:5e3,reconnect:!0,reconnectDelay:1e3,reconnectDelayMax:5e3,reconnectAttempts:10,resetSendBufferTimeout:1e4},y=!1,b=!1,j=m.Disconnected,w=0,k=!1,C=!1,x=!1,S=!1,A=[],T=!1,D=!1,L=!1,M=[],I="",B=function(){var t="&",e={};return e.unmarshalValues=function(e){if(!e)return!1;var n=e.indexOf(t),o=parseInt(e.substring(0,n),10);if(e=e.substring(n+1),0>o||o>e.length)return!1;var i=e.substr(0,o),r=e.substr(o);return{first:i,second:r}},e.marshalValues=function(e,n){return String(e.length)+t+e+n},e}(),O=function(){var t={},e={},n=function(t){var e={onMessageFunc:function(){}};return e.instance={onMessage:function(t){e.onMessageFunc=t},send:function(e,n){return e?s(p.ChannelData,B.marshalValues(t,e),n):-1}},e};return t.get=function(t){if(!t)return!1;var o=e[t];return o?o.instance:(o=n(t),e[t]=o,o.instance)},t.emitOnMessage=function(t,n){if(t&&n){var o=e[t];if(!o)return void console.log("glue: channel '"+t+"': emit onMessage event: channel does not exists");try{o.onMessageFunc(n)}catch(i){return void console.log("glue: channel '"+t+"': onMessage event call failed: "+i.message)}}},t}();c=function(t){return y?L?void y.send(t):void M.push(t):void 0};var E=function(){if(0!==M.length){for(var t=0;t<M.length;t++)c(M[t]);M=[]}},q=function(){D=!1,T!==!1&&(clearTimeout(T),T=!1)},R=function(){T!==!1||D||(T=setTimeout(function(){if(T=!1,D=!0,0!==A.length){for(var t,e=0;e<A.length;e++)if(t=A[e],t.discardCallback&&$.isFunction(t.discardCallback))try{t.discardCallback(t.data)}catch(n){console.log("glue: failed to call discard callback: "+n.message)}l("discard_send_buffer"),A=[]}},e.resetSendBufferTimeout))},P=function(){if(q(),0!==A.length){for(var t,e=0;e<A.length;e++)t=A[e],c(t.cmd+t.data);A=[]}};s=function(t,e,n){return e||(e=""),y&&j===m.Connected?(c(t+e),1):D?(n&&$.isFunction(n)&&n(e),-1):(R(),A.push({cmd:t,data:e,discardCallback:n}),0)};var U=function(){C!==!1&&(clearTimeout(C),C=!1)},F=function(){U(),C=setTimeout(function(){C=!1,l("connect_timeout"),a()},e.connectTimeout)},N=function(){x!==!1&&(clearTimeout(x),x=!1),S!==!1&&(clearTimeout(S),S=!1)},J=function(){N(),x=setTimeout(function(){x=!1,c(p.Ping),S=setTimeout(function(){S=!1,l("timeout"),a()},e.pingReconnectTimeout)},e.pingInterval)},_=function(){return b?void(y=o()):w>1?(o=d,y=o(),void(i=g.AjaxSocket)):(!e.forceSocketType&&window.WebSocket||e.forceSocketType===g.WebSocket?(o=u,i=g.WebSocket):(o=d,i=g.AjaxSocket),void(y=o()))},z=function(t){return t=JSON.parse(t),t.socketID?(I=t.socketID,L=!0,E(),j=m.Connected,l("connected"),void setTimeout(P,0)):(r(),void console.log("glue: socket initialization failed: invalid initialization data received"))},G=function(){_(),y.onOpen=function(){U(),w=0,b=!0,J();var t={version:h};t=JSON.stringify(t),y.send(p.Init+t)},y.onClose=function(){a()},y.onError=function(t){l("error",[t]),a()},y.onMessage=function(t){if(J(),t.length<p.Len)return void console.log("glue: received invalid data from server: data is too short.");var e=t.substr(0,p.Len);if(t=t.substr(p.Len),e===p.Ping)c(p.Pong);else if(e===p.Pong);else if(e===p.Invalid)console.log("glue: server replied with an invalid request notification!");else if(e===p.DontAutoReconnect)k=!0,console.log("glue: server replied with an don't automatically reconnect request. This might be due to an incompatible protocol version.");else if(e===p.Init)z(t);else if(e===p.ChannelData){var n=B.unmarshalValues(t);if(!n)return void console.log("glue: server requested an invalid channel data request: "+t);O.emitOnMessage(n.first,n.second)}else console.log("glue: received invalid data from server with command '"+e+"' and data '"+t+"'!")},setTimeout(function(){w>0?(j=m.Reconnecting,l("reconnecting")):(j=m.Connecting,l("connecting")),F(),y.open()},0)},V=function(){U(),N(),L=!1,I="",M=[],y&&(y.onOpen=y.onClose=y.onMessage=y.onError=function(){},y.reset(),y=!1)};if(a=function(){if(V(),e.reconnectAttempts>0&&w>e.reconnectAttempts||e.reconnect===!1||k)return j=m.Disconnected,void l("disconnected");w+=1;var t=e.reconnectDelay*w;t>e.reconnectDelayMax&&(t=e.reconnectDelayMax),setTimeout(function(){G()},t)},r=function(){y&&(c(p.Close),V(),j=m.Disconnected,l("disconnected"))},n=O.get(f),t||(t=window.location.protocol+"//"+window.location.host),!t.match("^http://")&&!t.match("^https://"))return void console.log("glue: invalid host: missing 'http://' or 'https://'!");e=$.extend(v,e),e.reconnectDelayMax<e.reconnectDelay&&(e.reconnectDelayMax=e.reconnectDelay),0!==e.baseURL.indexOf("/")&&(e.baseURL="/"+e.baseURL),"/"!==e.baseURL.slice(-1)&&(e.baseURL=e.baseURL+"/"),G();var W={version:function(){return h},type:function(){return i},state:function(){return j},socketID:function(){return I},send:function(t,e){n.send(t,e)},onMessage:function(t){n.onMessage(t)},on:function(){var t=$(W);t.on.apply(t,arguments)},reconnect:function(){j===m.Disconnected&&(w=0,k=!1,a())},close:function(){r()},channel:function(t){return O.get(t)}};return l=function(){var t=$(W);t.triggerHandler.apply(t,arguments)},W};Object.keys||(Object.keys=function(){var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=n.length;return function(i){if("object"!=typeof i&&("function"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var r,c,s=[];for(r in i)t.call(i,r)&&s.push(r);if(e)for(c=0;o>c;c++)t.call(i,n[c])&&s.push(n[c]);return s}}());var BitMonster=function(t){var e={};t||(t="");var n=function(){var t="&",e={},n=function(t,e){var n,o,i,r,c,s,a,l;for(n=3&t.length,o=t.length-n,i=e,c=3432918353,s=461845907,l=0;o>l;)a=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,a=(65535&a)*c+(((a>>>16)*c&65535)<<16)&4294967295,a=a<<15|a>>>17,a=(65535&a)*s+(((a>>>16)*s&65535)<<16)&4294967295,i^=a,i=i<<13|i>>>19,r=5*(65535&i)+((5*(i>>>16)&65535)<<16)&4294967295,i=(65535&r)+27492+(((r>>>16)+58964&65535)<<16);switch(a=0,n){case 3:a^=(255&t.charCodeAt(l+2))<<16;case 2:a^=(255&t.charCodeAt(l+1))<<8;case 1:a^=255&t.charCodeAt(l),a=(65535&a)*c+(((a>>>16)*c&65535)<<16)&4294967295,a=a<<15|a>>>17,a=(65535&a)*s+(((a>>>16)*s&65535)<<16)&4294967295,i^=a}return i^=t.length,i^=i>>>16,i=2246822507*(65535&i)+((2246822507*(i>>>16)&65535)<<16)&4294967295,i^=i>>>13,i=3266489909*(65535&i)+((3266489909*(i>>>16)&65535)<<16)&4294967295,i^=i>>>16,i>>>0};return e.storageAvailable=function(t){try{var e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),!0}catch(o){return!1}},e.callCatch=function(t){Array.prototype.shift.call(arguments);try{t.apply(t,arguments)}catch(e){console.log("BitMonster: catched exception while calling callback:"),console.log(e)}},e.randomString=function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;t>o;o++)e+=n.charAt(Math.floor(Math.random()*n.length));

return e},e.unmarshalValues=function(e){if(!e)return!1;var n=e.indexOf(t),o=parseInt(e.substring(0,n),10);if(e=e.substring(n+1),0>o||o>e.length)return!1;var i=e.substr(0,o),r=e.substr(o);return{first:i,second:r}},e.marshalValues=function(e,n){return String(e.length)+t+e+n},e.browserFingerprint=function(){var t=[navigator.userAgent,(new Date).getTimezoneOffset(),!!window.sessionStorage,!!window.localStorage,$.map(navigator.plugins,function(t){return[t.name,t.description,$.map(t,function(t){return[t.type,t.suffixes].join("~")}).join(",")].join("::")}).join(";")].join("###");return String(n(t,2155905152))},e.cookies={getItem:function(t){return t?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(t,e,n,o,i,r){if(!t||/^(?:expires|max\-age|path|domain|secure)$/i.test(t))return!1;var c="";if(n)switch(n.constructor){case Number:c=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:c="; expires="+n;break;case Date:c="; expires="+n.toUTCString()}return document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+c+(i?"; domain="+i:"")+(o?"; path="+o:"")+(r?"; secure":""),!0},removeItem:function(t,e,n){return this.hasItem(t)?(document.cookie=encodeURIComponent(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(e?"; path="+e:""),!0):!1},hasItem:function(t){return t?new RegExp("(?:^|;\\s*)"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie):!1},keys:function(){for(var t=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),e=t.length,n=0;e>n;n++)t[n]=decodeURIComponent(t[n]);return t}},e}(),o={en:{socket:{ConnectingTitle:"Connecting",ConnectingText:"Connecting to Server...",ConnLostTitle:"Connection Lost",ConnLostText:"Trying to reconnect to Server...",DiscardNotSendDataTitle:"Unsend Data",DiscardNotSendDataText:"Not all data messages could be transmitted to the server!",DisconnectedTitle:"Disconnected from Server",DisconnectedText:"Click here to reconnect."},auth:{FailedTitle:"Authentication failed",FailedText:"Failed to authenticate this session."}}},i=o.en,r=(navigator.language||navigator.browserLanguage).split("-")[0];r&&o[r]&&(i=o[r]),e.notification=function(t){function e(){var e=$("#"+u);return e.length?e:(e=$(h),$("body").prepend(e),t.hideClose?$("#"+u+" > div").remove():$("#"+u+" > div").on("click",function(){t.destroyOnClose?a():s()}),e)}function o(t){e().find("p").text(t)}function i(t){e().find("span").text(t)}function r(){d!==!1&&(clearTimeout(d),d=!1)}function c(t){var n=e();r(),n.removeClass("hide"),n.removeClass("show"),n.addClass("show"),t>0&&(d=setTimeout(function(){d=!1,s()},t))}function s(){var t=e();r(),t.addClass("hide"),d=setTimeout(function(){d=!1,t.removeClass("hide"),t.removeClass("show")},3e3)}function a(){var t=e();r(),t.addClass("hide"),d=setTimeout(function(){d=!1,t.remove()},3e3)}var l={title:"",text:"",destroyOnClose:!0,hideClose:!1},u="bm-notification-"+n.randomString(14),d=!1,h='<div id="'+u+'" class="bm-notification"><div><b></b><b></b><b></b><b></b></div><p></p><span></span></div>';return t=$.extend(l,t),e(),o(t.title),i(t.text),{setTitle:o,setText:i,show:c,hide:s,destroy:a,onClick:function(t){e().addClass("bm-clickable").on("click",t)}}};var c=function(){var t={},n=!1,o=e.notification({destroyOnClose:!1,hideClose:!0});return t.show=function(t){n===!1&&(t?(o.setTitle(i.socket.ConnectingTitle),o.setText(i.socket.ConnectingText)):(o.setTitle(i.socket.ConnLostTitle),o.setText(i.socket.ConnLostText)),n=setTimeout(function(){n=!1,o.show()},1500))},t.hide=function(){n!==!1&&(clearTimeout(n),n=!1),o.hide()},t}();e.scope=function(){var t={};return function(e){if(!e)return console.log("BitMonster: invalid scope call: scope='"+e+"'"),!1;var n=t[e];n||(n={events:[]});for(var o=1;o<arguments.length;o++){var i=arguments[o];$.isFunction(i.off)?n.events.push(i):console.log("BitMonster: invalid scope call: passed invalid argument: skipping argument...")}return t[e]=n,{off:function(){for(var o=0;o<n.events.length;o++)n.events[o].off();delete t[e]}}}}();var s=function(){var n=!1,o=glue(t,{baseURL:"/bitmonster/",resetSendBufferTimeout:2e4});return o?(o.on("connected",function(){n=!0,c.hide()}),o.on("connecting",function(){c.show(!n)}),o.on("reconnecting",function(){c.show(!n)}),o.on("disconnected",function(){c.hide();var t=e.notification({title:i.socket.DisconnectedTitle,text:i.socket.DisconnectedText,hideClose:!0});t.onClick(function(){t.destroy(),o.reconnect()}),t.show()}),o.on("error",function(t,e){console.log("BitMonster: socket error: "+e)}),o.on("discard_send_buffer",function(){e.notification({title:i.socket.DiscardNotSendDataTitle,text:i.socket.DiscardNotSendDataText}).show()}),o):void console.log("BitMonster: failed to initialize socket!")}();return e.module=function(){var t=14,e=10,o=12e3,i=s.channel("call"),r=s.channel("event"),c={},a={};i.onMessage(function(t){var e=function(){console.log("BitMonster: received invalid call request from server.")};try{t=JSON.parse(t)}catch(o){return void e()}if(!t.callbackID||0===String(t.callbackID).length)return void e();var i=c[t.callbackID];return i?(delete c[t.callbackID],i.timeout&&(clearTimeout(i.timeout),i.timeout=!1),void("cleanup"!==t.type&&("success"===t.type&&i.success?n.callCatch(i.success,t.data):"error"===t.type&&i.error?n.callCatch(i.error,t.message):e()))):void e()}),r.onMessage(function(t){var e=function(){console.log("BitMonster: received invalid event request from server.")};try{t=JSON.parse(t)}catch(n){return void e()}if(!t.module||!t.event)return void e();var o=a[t.module];if(o){var i=o.events[t.event];if(i)if("trigger"===t.type){var r;if(t.data)try{r=JSON.parse(t.data)}catch(n){return void e()}var c=jQuery.extend({},i.listeners);$.each(c,function(t,e){try{e.callback(r)}catch(n){console.log("BitMonster: catched exception while triggering event:"),console.log(n)}})}else e()}});var l=function(e,r){var s=!1,a=!1,l=!1,u=function(){console.log("BitMonster: invalid method call: module='"+e+"' method='"+r+"'")};if(!r)return u(),!1;for(var d=2;d<arguments.length;d++){var h=arguments[d];if(null!==h&&"object"==typeof h){if(s!==!1)return u(),!1;s=h}else{if(!$.isFunction(h))return u(),!1;if(a===!1)a=h;else{if(l!==!1)return u(),!1;l=h}}}s=s?JSON.stringify(s):"";var f={module:e,method:r};if(a!==!1||l!==!1){for(var g;;)if(g=n.randomString(t),!c[g])break;var p={success:a,error:l};p.timeout=setTimeout(function(){p.timeout=!1,delete c[g],p.error&&p.error("method call timeout: no server response received within the timeout")},o),c[g]=p,f.callbackID=g,f.callbackSuccess=a!==!1,f.callbackError=l!==!1}return f=JSON.stringify(f),i.send(n.marshalValues(f,s)),!0},u=function(t,e,n){var o=a[t];if(o){var i=o.events[e];if(i&&(delete i.listeners[n],!(Object.keys(i.listeners).length>0))){delete o.events[e];var c={type:"off",module:t,event:e};c=JSON.stringify(c),r.send(c)}}},d=function(t,e){var n={type:"on",module:t,event:e};n=JSON.stringify(n),r.send(n)},h=function(t,o,i){var r=a[t];r||(r={events:{}},a[t]=r);var c=r.events[o];c||(c={listeners:{}},r.events[o]=c);for(var s;;)if(s=n.randomString(e),!c.listeners[s])break;return c.listeners[s]={callback:i},1==Object.keys(c.listeners).length&&d(t,o,s),{off:function(){u(t,o,s)}}};return $(s).on("connected_and_auth",function(){$.each(a,function(t,e){$.each(e.events,function(e,n){d(t,e)})})}),function(t){return t?{call:function(){return Array.prototype.unshift.call(arguments,t),l.apply(l,arguments)},on:function(){return Array.prototype.unshift.call(arguments,t),h.apply(h,arguments)}}:(console.log("BitMonster: invalid module call: module='"+t+"'"),!1)}}(),e.auth=function(){function t(){return b||(b=n.browserFingerprint()),b}function o(){if(n.storageAvailable("localStorage")){var t=localStorage[v];if(t){try{t=JSON.parse(t)}catch(e){return void console.log("BitMonster: failed to decode saved auth data JSON: "+e)}t.authUserID&&(j=t.authUserID)}}}function r(){if(n.storageAvailable("localStorage")){var t={authUserID:j};localStorage.setItem(v,JSON.stringify(t))}}function c(){var e;if(n.storageAvailable("localStorage")?e=localStorage[m]:n.cookies.hasItem(m)&&(e=n.cookies.getItem(m)),!e)return"";try{e=sjcl.decrypt(t(),e)}catch(o){return console.log("BitMonster: failed to decrypt authentication token: "+o),""}return e}function a(e){try{e=sjcl.encrypt(t(),e)}catch(o){return void console.log("BitMonster: failed to encrypt authentication token: "+o)}n.storageAvailable("localStorage")?localStorage.setItem(m,e):n.cookies.setItem(m,e,2592e3)}function l(){n.storageAvailable("localStorage")?localStorage.removeItem(m):n.cookies.removeItem(m)}function u(e,o){var i=c();if(!i)return!1;var r=function(t){f(!1),l(),o&&(n.callCatch(o,t),o=void 0)},s={token:i,fingerprint:t()},u=function(t){return t.user&&t.user.id?(t.token&&a(t.token),f(t.user.id),void(e&&n.callCatch(e))):(r("invalid user data received"),void h())};return y.call("authenticate",s,u,function(t){y.call("authenticate",s,u,function(t){r(t)})}),!0}function d(e,o,i,r){var c=function(){var c=function(t){r&&(n.callCatch(r,t),r=void 0)};if(!e||!o)return void c("invalid login credentials");var s={username:e,password:o,fingerprint:t()};y.call("login",s,function(t){return t.token?(a(t.token),u(i,r)?void 0:void c("authentication failed")):void c("login failed: invalid authentication token")},function(t){c(t)})};"connected"!==s.state()?s.on("connected",c):c()}function h(){f(!1),l(),y.call("logout",function(){},function(t){console.log("BitMonster: failed to logout socket session"),t&&console.log(t)})}function f(t){j!==t&&(j=t,r(),j?($(w).trigger("authChanged",[!0]),$(w).trigger("onAuth")):$(w).trigger("authChanged",[!1]))}function g(){return j?j:!1}function p(){return j?!0:!1}var m="BMAuthToken",v="BMAuthData",y=e.module("auth"),b=!1,j=!1,w={login:d,logout:h,getUserID:g,isAuth:p,onAuth:function(t){$(w).on("onAuth",t)},onAuthChanged:function(t){$(w).on("authChanged",t)}};return o(),s.on("connected",function(){var t=u(function(){$(s).trigger("connected_and_auth")},function(t){$(s).trigger("connected_and_auth"),console.log("BitMonster: failed to authenticate"),t&&console.log("error message: "+t),e.notification({title:i.auth.FailedTitle,text:i.auth.FailedText}).show(1e4)});t||$(s).trigger("connected_and_auth")}),y.on("reauthenticate",function(){u(void 0,function(t){console.log("BitMonster: failed to reauthenticate"),t&&console.log("error message: "+t),e.notification({title:i.auth.FailedTitle,text:i.auth.FailedText}).show(1e4)})}),w}(),e};